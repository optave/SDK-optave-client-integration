/*! For license information please see browser.mjs.LICENSE.txt */
var e={};function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t(e)}function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,o(n.key),n)}}function o(e){var r=function(e){if("object"!=t(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=t(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==t(r)?r:r+""}function i(e){var t="function"==typeof Map?new Map:void 0;return i=function(e){if(null===e||!function(e){try{return-1!==Function.toString.call(e).indexOf("[native code]")}catch(t){return"function"==typeof e}}(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return function(e,t,r){if(s())return Reflect.construct.apply(null,arguments);var n=[null];n.push.apply(n,t);var o=new(e.bind.apply(e,n));return r&&a(o,r.prototype),o}(e,arguments,c(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),a(r,e)},i(e)}function s(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(s=function(){return!!e})()}function a(e,t){return a=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},a(e,t)}function c(e){return c=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},c(e)}e.d=(t,r)=>{for(var n in r)e.o(r,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:r[n]})},e.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var u=function(){function e(){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),(r=function(e,r,n){return r=c(r),function(e,r){if(r&&("object"==t(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,s()?Reflect.construct(r,n||[],c(e).constructor):r.apply(e,n))}(this,e))._events={},r._eventsCount=0,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&a(e,t)}(e,i(EventTarget)),o=e,u=[{key:"on",value:function(e,t){this._events[e]||(this._events[e]=[]),this._events[e].push(t),this._eventsCount++;var n=function(e){e.detail&&Array.isArray(e.detail)?t.apply(void 0,function(e){return function(e){if(Array.isArray(e))return r(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return r(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(e.detail)):t(e.detail||e)};return t._wrapped=n,this.addEventListener(e,n),this}},{key:"off",value:function(e,t){if(this._events[e]){var r=this._events[e].indexOf(t);r>-1&&(this._events[e].splice(r,1),this._eventsCount--,0===this._events[e].length&&delete this._events[e])}return t._wrapped&&(this.removeEventListener(e,t._wrapped),delete t._wrapped),this}},{key:"removeListener",value:function(e,t){return this.off(e,t)}},{key:"emit",value:function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];var o=new CustomEvent(e,{detail:r});return this.dispatchEvent(o),this}},{key:"once",value:function(e,t){var r=this,n=function(){r.off(e,n),t.apply(void 0,arguments)};return this.on(e,n)}},{key:"listenerCount",value:function(e){return this._events[e]?this._events[e].length:0}},{key:"removeAllListeners",value:function(e){var t=this;if(e){if(this._events[e]){var r=this._events[e].length;this._events[e].forEach(function(r){r._wrapped&&(t.removeEventListener(e,r._wrapped),delete r._wrapped)}),delete this._events[e],this._eventsCount=Math.max(0,this._eventsCount-r)}}else Object.values(this._events).reduce(function(e,t){return e+t.length},0),Object.keys(this._events).forEach(function(e){return t.removeAllListeners(e)}),this._eventsCount=0;return this}}],u&&n(o.prototype,u),Object.defineProperty(o,"prototype",{writable:!1}),o;var o,u}();const l=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i,d=function(e){if(!function(e){return"string"==typeof e&&l.test(e)}(e))throw TypeError("Invalid UUID");let t;return Uint8Array.of((t=parseInt(e.slice(0,8),16))>>>24,t>>>16&255,t>>>8&255,255&t,(t=parseInt(e.slice(9,13),16))>>>8,255&t,(t=parseInt(e.slice(14,18),16))>>>8,255&t,(t=parseInt(e.slice(19,23),16))>>>8,255&t,(t=parseInt(e.slice(24,36),16))/1099511627776&255,t/4294967296&255,t>>>24&255,t>>>16&255,t>>>8&255,255&t)},f=[];for(let e=0;e<256;++e)f.push((e+256).toString(16).slice(1));function p(e,t=0){return(f[e[t+0]]+f[e[t+1]]+f[e[t+2]]+f[e[t+3]]+"-"+f[e[t+4]]+f[e[t+5]]+"-"+f[e[t+6]]+f[e[t+7]]+"-"+f[e[t+8]]+f[e[t+9]]+"-"+f[e[t+10]]+f[e[t+11]]+f[e[t+12]]+f[e[t+13]]+f[e[t+14]]+f[e[t+15]]).toLowerCase()}let v;const h=new Uint8Array(16);function y(){if(!v){if("undefined"==typeof crypto||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");v=crypto.getRandomValues.bind(crypto)}return v(h)}function m(e){return 14+(e+64>>>9<<4)+1}function b(e,t){const r=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(r>>16)<<16|65535&r}function g(e,t,r,n,o,i){return b((s=b(b(t,e),b(n,i)))<<(a=o)|s>>>32-a,r);var s,a}function S(e,t,r,n,o,i,s){return g(t&r|~t&n,e,t,o,i,s)}function E(e,t,r,n,o,i,s){return g(t&n|r&~n,e,t,o,i,s)}function w(e,t,r,n,o,i,s){return g(t^r^n,e,t,o,i,s)}function _(e,t,r,n,o,i,s){return g(r^(t|~n),e,t,o,i,s)}const O=function(e){return function(e){const t=new Uint8Array(4*e.length);for(let r=0;r<4*e.length;r++)t[r]=e[r>>2]>>>r%4*8&255;return t}(function(e,t){const r=new Uint32Array(m(t)).fill(0);r.set(e),r[t>>5]|=128<<t%32,r[r.length-1]=t,e=r;let n=1732584193,o=-271733879,i=-1732584194,s=271733878;for(let t=0;t<e.length;t+=16){const r=n,a=o,c=i,u=s;n=S(n,o,i,s,e[t],7,-680876936),s=S(s,n,o,i,e[t+1],12,-389564586),i=S(i,s,n,o,e[t+2],17,606105819),o=S(o,i,s,n,e[t+3],22,-1044525330),n=S(n,o,i,s,e[t+4],7,-176418897),s=S(s,n,o,i,e[t+5],12,1200080426),i=S(i,s,n,o,e[t+6],17,-1473231341),o=S(o,i,s,n,e[t+7],22,-45705983),n=S(n,o,i,s,e[t+8],7,1770035416),s=S(s,n,o,i,e[t+9],12,-1958414417),i=S(i,s,n,o,e[t+10],17,-42063),o=S(o,i,s,n,e[t+11],22,-1990404162),n=S(n,o,i,s,e[t+12],7,1804603682),s=S(s,n,o,i,e[t+13],12,-40341101),i=S(i,s,n,o,e[t+14],17,-1502002290),o=S(o,i,s,n,e[t+15],22,1236535329),n=E(n,o,i,s,e[t+1],5,-165796510),s=E(s,n,o,i,e[t+6],9,-1069501632),i=E(i,s,n,o,e[t+11],14,643717713),o=E(o,i,s,n,e[t],20,-373897302),n=E(n,o,i,s,e[t+5],5,-701558691),s=E(s,n,o,i,e[t+10],9,38016083),i=E(i,s,n,o,e[t+15],14,-660478335),o=E(o,i,s,n,e[t+4],20,-405537848),n=E(n,o,i,s,e[t+9],5,568446438),s=E(s,n,o,i,e[t+14],9,-1019803690),i=E(i,s,n,o,e[t+3],14,-187363961),o=E(o,i,s,n,e[t+8],20,1163531501),n=E(n,o,i,s,e[t+13],5,-1444681467),s=E(s,n,o,i,e[t+2],9,-51403784),i=E(i,s,n,o,e[t+7],14,1735328473),o=E(o,i,s,n,e[t+12],20,-1926607734),n=w(n,o,i,s,e[t+5],4,-378558),s=w(s,n,o,i,e[t+8],11,-2022574463),i=w(i,s,n,o,e[t+11],16,1839030562),o=w(o,i,s,n,e[t+14],23,-35309556),n=w(n,o,i,s,e[t+1],4,-1530992060),s=w(s,n,o,i,e[t+4],11,1272893353),i=w(i,s,n,o,e[t+7],16,-155497632),o=w(o,i,s,n,e[t+10],23,-1094730640),n=w(n,o,i,s,e[t+13],4,681279174),s=w(s,n,o,i,e[t],11,-358537222),i=w(i,s,n,o,e[t+3],16,-722521979),o=w(o,i,s,n,e[t+6],23,76029189),n=w(n,o,i,s,e[t+9],4,-640364487),s=w(s,n,o,i,e[t+12],11,-421815835),i=w(i,s,n,o,e[t+15],16,530742520),o=w(o,i,s,n,e[t+2],23,-995338651),n=_(n,o,i,s,e[t],6,-198630844),s=_(s,n,o,i,e[t+7],10,1126891415),i=_(i,s,n,o,e[t+14],15,-1416354905),o=_(o,i,s,n,e[t+5],21,-57434055),n=_(n,o,i,s,e[t+12],6,1700485571),s=_(s,n,o,i,e[t+3],10,-1894986606),i=_(i,s,n,o,e[t+10],15,-1051523),o=_(o,i,s,n,e[t+1],21,-2054922799),n=_(n,o,i,s,e[t+8],6,1873313359),s=_(s,n,o,i,e[t+15],10,-30611744),i=_(i,s,n,o,e[t+6],15,-1560198380),o=_(o,i,s,n,e[t+13],21,1309151649),n=_(n,o,i,s,e[t+4],6,-145523070),s=_(s,n,o,i,e[t+11],10,-1120210379),i=_(i,s,n,o,e[t+2],15,718787259),o=_(o,i,s,n,e[t+9],21,-343485551),n=b(n,r),o=b(o,a),i=b(i,c),s=b(s,u)}return Uint32Array.of(n,o,i,s)}(function(e){if(0===e.length)return new Uint32Array;const t=new Uint32Array(m(8*e.length)).fill(0);for(let r=0;r<e.length;r++)t[r>>2]|=(255&e[r])<<r%4*8;return t}(e),8*e.length))},I="6ba7b810-9dad-11d1-80b4-00c04fd430c8",k="6ba7b811-9dad-11d1-80b4-00c04fd430c8";function A(e,t,r,n,o,i){const s="string"==typeof r?function(e){e=unescape(encodeURIComponent(e));const t=new Uint8Array(e.length);for(let r=0;r<e.length;++r)t[r]=e.charCodeAt(r);return t}(r):r,a="string"==typeof n?d(n):n;if("string"==typeof n&&(n=d(n)),16!==n?.length)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let c=new Uint8Array(16+s.length);if(c.set(a),c.set(s,a.length),c=t(c),c[6]=15&c[6]|e,c[8]=63&c[8]|128,o){i=i||0;for(let e=0;e<16;++e)o[i+e]=c[e];return o}return p(c)}function T(e,t,r,n){return A(48,O,e,t,r,n)}function R(e,t,r,n){switch(e){case 0:return t&r^~t&n;case 1:case 3:return t^r^n;case 2:return t&r^t&n^r&n}}function q(e,t){return e<<t|e>>>32-t}T.DNS=I,T.URL=k,"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const P=function(e){const t=[1518500249,1859775393,2400959708,3395469782],r=[1732584193,4023233417,2562383102,271733878,3285377520],n=new Uint8Array(e.length+1);n.set(e),n[e.length]=128;const o=(e=n).length/4+2,i=Math.ceil(o/16),s=new Array(i);for(let t=0;t<i;++t){const r=new Uint32Array(16);for(let n=0;n<16;++n)r[n]=e[64*t+4*n]<<24|e[64*t+4*n+1]<<16|e[64*t+4*n+2]<<8|e[64*t+4*n+3];s[t]=r}s[i-1][14]=8*(e.length-1)/Math.pow(2,32),s[i-1][14]=Math.floor(s[i-1][14]),s[i-1][15]=8*(e.length-1)&4294967295;for(let e=0;e<i;++e){const n=new Uint32Array(80);for(let t=0;t<16;++t)n[t]=s[e][t];for(let e=16;e<80;++e)n[e]=q(n[e-3]^n[e-8]^n[e-14]^n[e-16],1);let o=r[0],i=r[1],a=r[2],c=r[3],u=r[4];for(let e=0;e<80;++e){const r=Math.floor(e/20),s=q(o,5)+R(r,i,a,c)+u+t[r]+n[e]>>>0;u=c,c=a,a=q(i,30)>>>0,i=o,o=s}r[0]=r[0]+o>>>0,r[1]=r[1]+i>>>0,r[2]=r[2]+a>>>0,r[3]=r[3]+c>>>0,r[4]=r[4]+u>>>0}return Uint8Array.of(r[0]>>24,r[0]>>16,r[0]>>8,r[0],r[1]>>24,r[1]>>16,r[1]>>8,r[1],r[2]>>24,r[2]>>16,r[2]>>8,r[2],r[3]>>24,r[3]>>16,r[3]>>8,r[3],r[4]>>24,r[4]>>16,r[4]>>8,r[4])};function j(e,t,r,n){return A(80,P,e,t,r,n)}j.DNS=I,j.URL=k;const C={};function N(e,t,r,n,o=0){if(e.length<16)throw new Error("Random bytes length must be >= 16");if(n){if(o<0||o+16>n.length)throw new RangeError(`UUID byte range ${o}:${o+15} is out of buffer bounds`)}else n=new Uint8Array(16),o=0;return t??=Date.now(),r??=127*e[6]<<24|e[7]<<16|e[8]<<8|e[9],n[o++]=t/1099511627776&255,n[o++]=t/4294967296&255,n[o++]=t/16777216&255,n[o++]=t/65536&255,n[o++]=t/256&255,n[o++]=255&t,n[o++]=112|r>>>28&15,n[o++]=r>>>20&255,n[o++]=128|r>>>14&63,n[o++]=r>>>6&255,n[o++]=r<<2&255|3&e[10],n[o++]=e[11],n[o++]=e[12],n[o++]=e[13],n[o++]=e[14],n[o++]=e[15],n}const U=function(e,t,r){let n;if(e)n=N(e.random??e.rng?.()??y(),e.msecs,e.seq,t,r);else{const e=Date.now(),o=y();!function(e,t,r){e.msecs??=-1/0,e.seq??=0,t>e.msecs?(e.seq=r[6]<<23|r[7]<<16|r[8]<<8|r[9],e.msecs=t):(e.seq=e.seq+1|0,0===e.seq&&e.msecs++)}(C,e,o),n=N(o,C.msecs,C.seq,t,r)}return t??p(n)};function W(e){return W="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},W(e)}function D(e,t){return{instancePath:e,message:t,keyword:arguments.length>2&&void 0!==arguments[2]?arguments[2]:"validation",params:arguments.length>3&&void 0!==arguments[3]?arguments[3]:{}}}function M(e){if(!e||"object"!==W(e))return{valid:!1,errors:[D("","must be object","type",{type:"object"})]};var t=[];return e.session?"object"!==W(e.session)?t.push(D("/session","must be object","type",{type:"object"})):void 0!==e.session.sessionId&&"string"!=typeof e.session.sessionId&&t.push(D("/session/sessionId","must be string","type",{type:"string"})):t.push(D("/session","is required","required",{missingProperty:"session"})),e.request?"object"!==W(e.request)?t.push(D("/request","must be object","type",{type:"object"})):(e.request.connections?"object"!==W(e.request.connections)?t.push(D("/request/connections","must be object","type",{type:"object"})):(e.request.connections.threadId?"string"!=typeof e.request.connections.threadId&&t.push(D("/request/connections/threadId","must be string","type",{type:"string"})):t.push(D("/request/connections/threadId","is required","required",{missingProperty:"threadId"})),void 0!==e.request.connections.parentId&&"string"!=typeof e.request.connections.parentId&&t.push(D("/request/connections/parentId","must be string","type",{type:"string"}))):t.push(D("/request/connections","is required","required",{missingProperty:"connections"})),void 0!==e.request.context&&"object"!==W(e.request.context)&&t.push(D("/request/context","must be object","type",{type:"object"})),void 0!==e.request.attributes&&"object"!==W(e.request.attributes)&&t.push(D("/request/attributes","must be object","type",{type:"object"})),void 0!==e.request.scope&&("object"!==W(e.request.scope)?t.push(D("/request/scope","must be object","type",{type:"object"})):void 0!==e.request.scope.conversations&&(Array.isArray(e.request.scope.conversations)||t.push(D("/request/scope/conversations","must be array","type",{type:"array"})))),void 0!==e.request.resources&&("object"!==W(e.request.resources)?t.push(D("/request/resources","must be object","type",{type:"object"})):void 0!==e.request.resources.offers&&(Array.isArray(e.request.resources.offers)||t.push(D("/request/resources/offers","must be array","type",{type:"array"}))))):t.push(D("/request","is required","required",{missingProperty:"request"})),t.length>0?{valid:!1,errors:t}:{valid:!0,errors:null}}function L(e){if(!e||"object"!==W(e))return{valid:!1,errors:[D("","must be object","type",{type:"object"})]};var t=[];if(e.headers)if("object"!==W(e.headers))t.push(D("/headers","must be object","type",{type:"object"}));else{if(e.headers.correlationId?"string"!=typeof e.headers.correlationId&&t.push(D("/headers/correlationId","must be string","type",{type:"string"})):t.push(D("/headers/correlationId","is required","required",{missingProperty:"correlationId"})),e.headers.action)if("string"!=typeof e.headers.action)t.push(D("/headers/action","must be string","type",{type:"string"}));else{var r=["adjust","elevate","interaction","customerinteraction","reception","summarize","translate","recommend","insights"];r.includes(e.headers.action)||t.push(D("/headers/action","must be equal to one of the allowed values","enum",{allowedValues:r}))}else t.push(D("/headers/action","is required","required",{missingProperty:"action"}));void 0!==e.headers.identifier&&"string"!=typeof e.headers.identifier&&t.push(D("/headers/identifier","must be string","type",{type:"string"})),void 0!==e.headers.schemaRef&&"string"!=typeof e.headers.schemaRef&&t.push(D("/headers/schemaRef","must be string","type",{type:"string"})),void 0!==e.headers.timestamp&&"string"!=typeof e.headers.timestamp&&t.push(D("/headers/timestamp","must be string","type",{type:"string"}))}else t.push(D("/headers","is required","required",{missingProperty:"headers"}));if(e.payload){if("object"!==W(e.payload))t.push(D("/payload","must be object","type",{type:"object"}));else if(e.headers&&e.headers.action&&e.payload){var n=e.headers.action;["adjust","elevate","interaction","customerinteraction","customerInteraction","summarize","translate","insights","recommend"].includes(n)&&(e.payload.request?e.payload.request.scope?e.payload.request.scope.conversations?Array.isArray(e.payload.request.scope.conversations)?0===e.payload.request.scope.conversations.length&&t.push(D("/payload/request/scope/conversations","must be non-empty array for ".concat(n),"minItems",{limit:1})):t.push(D("/payload/request/scope/conversations","must be array","type",{type:"array"})):t.push(D("/payload/request/scope/conversations","is required for ".concat(n),"required",{missingProperty:"conversations"})):t.push(D("/payload/request/scope","is required","required",{missingProperty:"scope"})):t.push(D("/payload/request","is required","required",{missingProperty:"request"})))}}else t.push(D("/payload","is required","required",{missingProperty:"payload"}));return t.length>0?{valid:!1,errors:t}:{valid:!0,errors:null}}var V="3.2.1",B=V.split(".")[0],K="optave.message.v".concat(B),G={AUTHENTICATION:"AUTHENTICATION",ORCHESTRATOR:"ORCHESTRATOR",VALIDATION:"VALIDATION",WEBSOCKET:"WEBSOCKET"},x=Object.freeze({MESSAGE:"message",ERROR:"error"}),z=Object.freeze({CONNECTION_OPEN:"connection:open",CONNECTION_CLOSE:"connection:close",CONNECTION_ERROR:"connection:error",MESSAGE_RECEIVED:"message:received",MESSAGE_SENT:"message:sent",ERROR:"error",RESPONSE:"response",LEGACY_ERROR:"error",LEGACY_MESSAGE:"message"}),F=Object.freeze({SUPERPOWER_RESPONSE:"superpower.response",SUPERPOWER_ERROR:"superpower.error"}),H=new Set(["adjust","elevate","interaction","reception","customerInteraction","summarize","translate","recommend","insights"]);const Y={SPEC_VERSION:V,SCHEMA_REF:K,MAX_PAYLOAD_SIZE:131072,MAX_PAYLOAD_SIZE_KB:128,DEFAULT_REQUEST_TIMEOUT_MS:3e4,ErrorCategory:G,LegacyEvents:x,EVENTS:z,InboundEvents:F,ALLOWED_ACTIONS:H};function J(e){return function(e){if(Array.isArray(e))return X(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||Q(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Q(e,t){if(e){if("string"==typeof e)return X(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?X(e,t):void 0}}function X(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function Z(){var e,t,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",o=r.toStringTag||"@@toStringTag";function i(r,n,o,i){var c=n&&n.prototype instanceof a?n:a,u=Object.create(c.prototype);return $(u,"_invoke",function(r,n,o){var i,a,c,u=0,l=o||[],d=!1,f={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,r){return i=t,a=0,c=e,f.n=r,s}};function p(r,n){for(a=r,c=n,t=0;!d&&u&&!o&&t<l.length;t++){var o,i=l[t],p=f.p,v=i[2];r>3?(o=v===n)&&(c=i[(a=i[4])?5:(a=3,3)],i[4]=i[5]=e):i[0]<=p&&((o=r<2&&p<i[1])?(a=0,f.v=n,f.n=i[1]):p<v&&(o=r<3||i[0]>n||n>v)&&(i[4]=r,i[5]=n,f.n=v,a=0))}if(o||r>1)return s;throw d=!0,n}return function(o,l,v){if(u>1)throw TypeError("Generator is already running");for(d&&1===l&&p(l,v),a=l,c=v;(t=a<2?e:c)||!d;){i||(a?a<3?(a>1&&(f.n=-1),p(a,c)):f.n=c:f.v=c);try{if(u=2,i){if(a||(o="next"),t=i[o]){if(!(t=t.call(i,c)))throw TypeError("iterator result is not an object");if(!t.done)return t;c=t.value,a<2&&(a=0)}else 1===a&&(t=i.return)&&t.call(i),a<2&&(c=TypeError("The iterator does not provide a '"+o+"' method"),a=1);i=e}else if((t=(d=f.n<0)?c:r.call(n,f))!==s)break}catch(t){i=e,a=1,c=t}finally{u=1}}return{value:t,done:d}}}(r,o,i),!0),u}var s={};function a(){}function c(){}function u(){}t=Object.getPrototypeOf;var l=[][n]?t(t([][n]())):($(t={},n,function(){return this}),t),d=u.prototype=a.prototype=Object.create(l);function f(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,$(e,o,"GeneratorFunction")),e.prototype=Object.create(d),e}return c.prototype=u,$(d,"constructor",u),$(u,"constructor",c),c.displayName="GeneratorFunction",$(u,o,"GeneratorFunction"),$(d),$(d,o,"Generator"),$(d,n,function(){return this}),$(d,"toString",function(){return"[object Generator]"}),(Z=function(){return{w:i,m:f}})()}function $(e,t,r,n){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}$=function(e,t,r,n){function i(t,r){$(e,t,function(e){return this._invoke(t,r,e)})}t?o?o(e,t,{value:r,enumerable:!n,configurable:!n,writable:!n}):e[t]=r:(i("next",0),i("throw",1),i("return",2))},$(e,t,r,n)}function ee(e,t,r,n,o,i,s){try{var a=e[i](s),c=a.value}catch(e){return void r(e)}a.done?t(c):Promise.resolve(c).then(n,o)}function te(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var i=e.apply(t,r);function s(e){ee(i,n,o,s,a,"next",e)}function a(e){ee(i,n,o,s,a,"throw",e)}s(void 0)})}}function re(e){var t,r={isValid:!0,errors:[],warnings:[]},n=function(e){var t=[];return e.websocketUrl&&"string"==typeof e.websocketUrl||t.push({type:"warning",code:"MISSING_WEBSOCKET_URL",message:"websocketUrl not provided; openConnection() will emit an error.",field:"websocketUrl"}),t}(e),o=function(e){var t=[];return!e.authenticationUrl||e.clientId&&e.clientSecret||t.push({type:"warning",code:"INCOMPLETE_AUTH_CONFIG",message:"authenticationUrl provided but clientId/clientSecret incomplete; authenticate() may fail.",field:"authentication"}),t}(e),i=function(e){var t=[];if(function(){if("undefined"!=typeof process&&process.versions,"undefined"!=typeof global){if("window"in global||"document"in global||"undefined"!=typeof process&&process.versions,(!("window"in global)||!("document"in global))&&"undefined"!=typeof process&&process.versions,"window"in global&&global.window)return!0;if("document"in global&&global.document)return!0}try{if("undefined"!=typeof window&&null!==window)return("undefined"==typeof global||"window"in global)&&("undefined"!=typeof global&&"undefined"!=typeof process&&process.versions,!0);if("undefined"!=typeof document&&null!==document)return("undefined"==typeof global||"document"in global)&&("undefined"!=typeof global&&"undefined"!=typeof process&&process.versions,!0)}catch(e){}return"undefined"!=typeof navigator&&"ReactNative"===navigator.product||!("undefined"==typeof global||!global.__expo)||"undefined"!=typeof location&&null!==location||("undefined"!=typeof process&&process.versions,!1)}()&&e.clientSecret){var r=!1,n=!1;try{r=!0===__SALESFORCE_BUILD__}catch(e){}try{n=!1}catch(e){}r||n||t.push({type:"error",code:"CLIENT_SECRET_IN_CLIENT_ENV",message:"clientSecret must not be supplied in a client environment (browser, mobile, Electron renderer). Use options.tokenProvider() to obtain a short-lived token.",field:"clientSecret"})}return t}(e),s=function(e){var t="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=Q(e))){t&&(e=t);var r=0,n=function(){};return{s:n,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,s=!1;return{s:function(){t=t.call(e)},n:function(){var e=t.next();return i=e.done,e},e:function(e){s=!0,o=e},f:function(){try{i||null==t.return||t.return()}finally{if(s)throw o}}}}([].concat(J(n),J(o),J(i)));try{for(s.s();!(t=s.n()).done;){var a=t.value;"error"===a.type?(r.errors.push(a),r.isValid=!1):"warning"===a.type&&r.warnings.push(a)}}catch(e){s.e(e)}finally{s.f()}return r}var ne={BROWSER_ESM:"browser-esm",SERVER_ESM:"server-esm",BROWSER_UMD:"browser-umd",SERVER_UMD:"server-umd"},oe={browser:ne.BROWSER_ESM,server:ne.SERVER_ESM},ie={BROWSER:[ne.BROWSER_ESM,ne.BROWSER_UMD,ne.SERVER_UMD],SERVER:[ne.SERVER_ESM],UMD:[ne.BROWSER_UMD,ne.SERVER_UMD],ESM:[ne.BROWSER_ESM,ne.SERVER_ESM]},se={isValid:function(e){return Object.values(ne).includes(e)||Object.keys(oe).includes(e)},normalize:function(e){return oe[e]?oe[e]:Object.values(ne).includes(e)?e:"unknown"},isBrowser:function(e){var t=this.normalize(e);return ie.BROWSER.includes(t)},isServer:function(e){var t=this.normalize(e);return ie.SERVER.includes(t)},isUMD:function(e){var t=this.normalize(e);return ie.UMD.includes(t)},isESM:function(e){var t=this.normalize(e);return ie.ESM.includes(t)},getInfo:function(e){return{original:e,normalized:this.normalize(e),valid:this.isValid(e),isBrowser:this.isBrowser(e),isServer:this.isServer(e),isUMD:this.isUMD(e),isESM:this.isESM(e)}}};function ae(e){return ae="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ae(e)}function ce(e){var t="function"==typeof Map?new Map:void 0;return ce=function(e){if(null===e||!function(e){try{return-1!==Function.toString.call(e).indexOf("[native code]")}catch(t){return"function"==typeof e}}(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return function(e,t,r){if(ue())return Reflect.construct.apply(null,arguments);var n=[null];n.push.apply(n,t);var o=new(e.bind.apply(e,n));return r&&le(o,r.prototype),o}(e,arguments,de(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),le(r,e)},ce(e)}function ue(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(ue=function(){return!!e})()}function le(e,t){return le=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},le(e,t)}function de(e){return de=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},de(e)}var fe=function(){function e(t){var r,n=t.category,o=t.code,i=t.message,s=t.details;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),(r=function(e,t,r){return t=de(t),function(e,t){if(t&&("object"==ae(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,ue()?Reflect.construct(t,r||[],de(e).constructor):t.apply(e,r))}(this,e,[i])).name="OptaveError",r.category=n||"UNKNOWN",r.code=o||"UNKNOWN",void 0!==s&&(r.details=s),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&le(e,t)}(e,ce(Error)),t=e,Object.defineProperty(t,"prototype",{writable:!1}),t;var t}();function pe(){var e,t,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",o=r.toStringTag||"@@toStringTag";function i(r,n,o,i){var c=n&&n.prototype instanceof a?n:a,u=Object.create(c.prototype);return ve(u,"_invoke",function(r,n,o){var i,a,c,u=0,l=o||[],d=!1,f={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,r){return i=t,a=0,c=e,f.n=r,s}};function p(r,n){for(a=r,c=n,t=0;!d&&u&&!o&&t<l.length;t++){var o,i=l[t],p=f.p,v=i[2];r>3?(o=v===n)&&(c=i[(a=i[4])?5:(a=3,3)],i[4]=i[5]=e):i[0]<=p&&((o=r<2&&p<i[1])?(a=0,f.v=n,f.n=i[1]):p<v&&(o=r<3||i[0]>n||n>v)&&(i[4]=r,i[5]=n,f.n=v,a=0))}if(o||r>1)return s;throw d=!0,n}return function(o,l,v){if(u>1)throw TypeError("Generator is already running");for(d&&1===l&&p(l,v),a=l,c=v;(t=a<2?e:c)||!d;){i||(a?a<3?(a>1&&(f.n=-1),p(a,c)):f.n=c:f.v=c);try{if(u=2,i){if(a||(o="next"),t=i[o]){if(!(t=t.call(i,c)))throw TypeError("iterator result is not an object");if(!t.done)return t;c=t.value,a<2&&(a=0)}else 1===a&&(t=i.return)&&t.call(i),a<2&&(c=TypeError("The iterator does not provide a '"+o+"' method"),a=1);i=e}else if((t=(d=f.n<0)?c:r.call(n,f))!==s)break}catch(t){i=e,a=1,c=t}finally{u=1}}return{value:t,done:d}}}(r,o,i),!0),u}var s={};function a(){}function c(){}function u(){}t=Object.getPrototypeOf;var l=[][n]?t(t([][n]())):(ve(t={},n,function(){return this}),t),d=u.prototype=a.prototype=Object.create(l);function f(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,ve(e,o,"GeneratorFunction")),e.prototype=Object.create(d),e}return c.prototype=u,ve(d,"constructor",u),ve(u,"constructor",c),c.displayName="GeneratorFunction",ve(u,o,"GeneratorFunction"),ve(d),ve(d,o,"Generator"),ve(d,n,function(){return this}),ve(d,"toString",function(){return"[object Generator]"}),(pe=function(){return{w:i,m:f}})()}function ve(e,t,r,n){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}ve=function(e,t,r,n){function i(t,r){ve(e,t,function(e){return this._invoke(t,r,e)})}t?o?o(e,t,{value:r,enumerable:!n,configurable:!n,writable:!n}):e[t]=r:(i("next",0),i("throw",1),i("return",2))},ve(e,t,r,n)}function he(e,t,r,n,o,i,s){try{var a=e[i](s),c=a.value}catch(e){return void r(e)}a.done?t(c):Promise.resolve(c).then(n,o)}function ye(){return me.apply(this,arguments)}function me(){var e;return e=pe().m(function e(){return pe().w(function(e){for(;;)if(0===e.n)return e.a(2,null)},e)}),me=function(){var t=this,r=arguments;return new Promise(function(n,o){var i=e.apply(t,r);function s(e){he(i,n,o,s,a,"next",e)}function a(e){he(i,n,o,s,a,"throw",e)}s(void 0)})},me.apply(this,arguments)}function be(e){return function(e){if(Array.isArray(e))return _e(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||we(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ge(e){return ge="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ge(e)}function Se(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,i,s,a=[],c=!0,u=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=i.call(r)).done)&&(a.push(n.value),a.length!==t);c=!0);}catch(e){u=!0,o=e}finally{try{if(!c&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(u)throw o}}return a}}(e,t)||we(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ee(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=we(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,a=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){a=!0,i=e},f:function(){try{s||null==r.return||r.return()}finally{if(a)throw i}}}}function we(e,t){if(e){if("string"==typeof e)return _e(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_e(e,t):void 0}}function _e(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function Oe(){var e,t,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",o=r.toStringTag||"@@toStringTag";function i(r,n,o,i){var c=n&&n.prototype instanceof a?n:a,u=Object.create(c.prototype);return Ie(u,"_invoke",function(r,n,o){var i,a,c,u=0,l=o||[],d=!1,f={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,r){return i=t,a=0,c=e,f.n=r,s}};function p(r,n){for(a=r,c=n,t=0;!d&&u&&!o&&t<l.length;t++){var o,i=l[t],p=f.p,v=i[2];r>3?(o=v===n)&&(c=i[(a=i[4])?5:(a=3,3)],i[4]=i[5]=e):i[0]<=p&&((o=r<2&&p<i[1])?(a=0,f.v=n,f.n=i[1]):p<v&&(o=r<3||i[0]>n||n>v)&&(i[4]=r,i[5]=n,f.n=v,a=0))}if(o||r>1)return s;throw d=!0,n}return function(o,l,v){if(u>1)throw TypeError("Generator is already running");for(d&&1===l&&p(l,v),a=l,c=v;(t=a<2?e:c)||!d;){i||(a?a<3?(a>1&&(f.n=-1),p(a,c)):f.n=c:f.v=c);try{if(u=2,i){if(a||(o="next"),t=i[o]){if(!(t=t.call(i,c)))throw TypeError("iterator result is not an object");if(!t.done)return t;c=t.value,a<2&&(a=0)}else 1===a&&(t=i.return)&&t.call(i),a<2&&(c=TypeError("The iterator does not provide a '"+o+"' method"),a=1);i=e}else if((t=(d=f.n<0)?c:r.call(n,f))!==s)break}catch(t){i=e,a=1,c=t}finally{u=1}}return{value:t,done:d}}}(r,o,i),!0),u}var s={};function a(){}function c(){}function u(){}t=Object.getPrototypeOf;var l=[][n]?t(t([][n]())):(Ie(t={},n,function(){return this}),t),d=u.prototype=a.prototype=Object.create(l);function f(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,Ie(e,o,"GeneratorFunction")),e.prototype=Object.create(d),e}return c.prototype=u,Ie(d,"constructor",u),Ie(u,"constructor",c),c.displayName="GeneratorFunction",Ie(u,o,"GeneratorFunction"),Ie(d),Ie(d,o,"Generator"),Ie(d,n,function(){return this}),Ie(d,"toString",function(){return"[object Generator]"}),(Oe=function(){return{w:i,m:f}})()}function Ie(e,t,r,n){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}Ie=function(e,t,r,n){function i(t,r){Ie(e,t,function(e){return this._invoke(t,r,e)})}t?o?o(e,t,{value:r,enumerable:!n,configurable:!n,writable:!n}):e[t]=r:(i("next",0),i("throw",1),i("return",2))},Ie(e,t,r,n)}function ke(e,t,r,n,o,i,s){try{var a=e[i](s),c=a.value}catch(e){return void r(e)}a.done?t(c):Promise.resolve(c).then(n,o)}function Ae(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var i=e.apply(t,r);function s(e){ke(i,n,o,s,a,"next",e)}function a(e){ke(i,n,o,s,a,"throw",e)}s(void 0)})}}function Te(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function Re(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Te(Object(r),!0).forEach(function(t){Ne(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Te(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function qe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Ue(n.key),n)}}function Pe(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(Pe=function(){return!!e})()}function je(e){return je=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},je(e)}function Ce(e,t){return Ce=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Ce(e,t)}function Ne(e,t,r){return(t=Ue(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Ue(e){var t=function(e){if("object"!=ge(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=ge(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==ge(t)?t:t+""}!function(){if("undefined"!=typeof globalThis&&(globalThis.__OPTAVE_SECURITY_GUARDS_ACTIVE__=!0,!globalThis.__OPTAVE_SECURITY_GUARDS_ACTIVE__))throw new Error("Security guard initialization failed");"undefined"!=typeof process&&process.env}(),"undefined"!=typeof window?window.__OPTAVE_SECURITY_GUARDS_BROWSER__=!0:"undefined"!=typeof global&&(global.__OPTAVE_SECURITY_GUARDS_NODE__=!0);var We="3.2.1",De=function(){var e="browser-esm";return{isBrowser:se.isBrowser(e),isServer:se.isServer(e),buildTarget:e}},Me=!1,Le=!1,Ve=function(){function e(t){var r,n;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Ne(n=function(e,t,r){return t=je(t),function(e,t){if(t&&("object"==ge(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,Pe()?Reflect.construct(t,r||[],je(e).constructor):t.apply(e,r))}(this,e),"options",{}),Ne(n,"wss",null),n.options=Re({},t),function(e){if(void 0===e.strictValidation){var t="undefined"!=typeof process&&process.env?"production":"development";e.strictValidation="production"!==t}if("number"!=typeof e.requestTimeoutMs&&(e.requestTimeoutMs=3e4),"number"!=typeof e.connectionTimeoutMs&&(e.connectionTimeoutMs=1e4),e.logger||(e.logger={debug:function(){},info:function(){},warn:function(){},error:function(){}}),e.authTransport||(e.authTransport="subprotocol"),void 0===e.authRequired&&(e.authRequired=!0),!e.tokenProvider){var r=e.tokenUrl;if(!r&&"undefined"!=typeof document){var n=document.querySelector('meta[name="optave-token-url"]');n&&n.content&&(r=n.content)}r||(r="/api/optave/ws-ticket"),e.tokenProvider=te(Z().m(function t(){var n,o,i;return Z().w(function(t){for(;;)switch(t.n){case 0:return n={},e.publishableKey&&(n["X-Optave-Publishable-Key"]=e.publishableKey),t.n=1,fetch(r,{method:"POST",credentials:"include",headers:n});case 1:if((o=t.v).ok){t.n=2;break}throw new Error("Failed to obtain WS token");case 2:return t.n=3,o.json();case 3:return i=t.v,t.a(2,i.token||i.access_token)}},t)}))}}(n.options),void 0===n.options.cspSafe){var o=De();"server-esm"===o.buildTarget||"server"===o.buildTarget?n.options.cspSafe=!1:("server-umd"===o.buildTarget||"browser-esm"===o.buildTarget||"browser-umd"===o.buildTarget||o.isBrowser||function(){var e=De();return"unknown"!==e.buildTarget?e.isBrowser:"undefined"!=typeof window&&void 0!==window.WebSocket}())&&(n.options.cspSafe=!0)}var i=re(n.options);if(!i.isValid){var s=i.errors.map(function(e){return e.message}).join("; ");throw new Error("[Optave SDK] Configuration errors: ".concat(s))}i.warnings.forEach(function(e){var t;((null===(t=n.options)||void 0===t||null===(t=t.logger)||void 0===t?void 0:t.warn)||console.warn)("[Optave SDK] ".concat(e.message))});try{!function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(e&&"string"==typeof e){var n=se.normalize(t),o=se.isUMD(n),i=se.isBrowser(n);if((o||i)&&e.startsWith("ws://")){var s="[Optave SDK] Insecure WebSocket protocol (ws://) is not allowed in UMD builds. Salesforce Lightning Locker Service blocks all ws:// connections for security reasons. Please use secure WebSocket protocol (wss://) instead. "+"Current URL: ".concat(e);throw new Error(s)}if(o&&e.startsWith("wss://")){var a="function"==typeof r.tokenProvider,c=!1===r.authRequired;if(!a&&!c){var u="[Optave SDK] UMD builds require a tokenProvider function for secure WebSocket connections. In constrained environments like Salesforce Lightning, authentication tokens must be obtained from your backend server. Please provide options.tokenProvider() that returns a valid token, or set options.authRequired = false to disable authentication. "+"Current URL: ".concat(e);throw new Error(u)}}}}(n.options.websocketUrl,"browser-esm",n.options)}catch(e){throw e}var a=De();return n.WebSocketImpl=n.options.WebSocketImpl,!n.WebSocketImpl&&a.isBrowser?n.WebSocketImpl=("undefined"!=typeof WebSocket?WebSocket:void 0)||("undefined"!=typeof window&&window.WebSocket?window.WebSocket:void 0):!n.WebSocketImpl&&a.isServer&&(n.WebSocketImpl="undefined"!=typeof WebSocket?WebSocket:void 0),n._pending=new Map,n._deprecatedKeys=new Set,n._silenceDeprecations="undefined"!=typeof process&&"1"===(null===(r=process)||void 0===r||null===(r=r.env)||void 0===r?void 0:r.OPTAVE_SDK_SILENCE_DEPRECATIONS),n.options.cspSafe,n._validatePayload=M,n._validateMessageEnvelope=L,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Ce(e,t)}(e,u),t=e,r=[{key:"_ensureWebSocketImpl",value:(a=Ae(Oe().m(function e(){var t;return Oe().w(function(e){for(;;)switch(e.n){case 0:if(!this.WebSocketImpl){e.n=1;break}return e.a(2,this.WebSocketImpl);case 1:if(t=De(),this.WebSocketImpl=this.options.WebSocketImpl,!this.WebSocketImpl&&t.isBrowser?this.WebSocketImpl=("undefined"!=typeof WebSocket?WebSocket:void 0)||("undefined"!=typeof window&&window.WebSocket?window.WebSocket:void 0):!this.WebSocketImpl&&t.isServer&&(this.WebSocketImpl="undefined"!=typeof WebSocket?WebSocket:void 0),this.WebSocketImpl){e.n=4;break}if(!t.isBrowser){e.n=2;break}this.WebSocketImpl="undefined"!=typeof WebSocket?WebSocket:null,e.n=4;break;case 2:if(!t.isServer){e.n=4;break}return e.n=3,this.loadNodeWebSocket();case 3:this.WebSocketImpl=e.v;case 4:return e.a(2,this.WebSocketImpl)}},e,this)})),function(){return a.apply(this,arguments)})},{key:"loadNodeWebSocket",value:(s=Ae(Oe().m(function e(){var t;return Oe().w(function(e){for(;;)switch(e.n){case 0:if(!(t=De()).isBrowser){e.n=1;break}return e.a(2,null);case 1:if("unknown"!==t.buildTarget||"undefined"==typeof window&&"undefined"==typeof document&&"undefined"==typeof navigator&&"undefined"==typeof location){e.n=2;break}return e.a(2,null);case 2:return"undefined"==typeof process||process.versions,e.a(2,null);case 3:return e.n=4,ye();case 4:return e.a(2,e.v)}},e)})),function(){return s.apply(this,arguments)})},{key:"setSessionId",value:function(e){return this.sessionId=e,this}},{key:"getSessionId",value:function(){return this.sessionId||""}},{key:"validate",value:function(e){return this._validatePayload(e).valid}},{key:"validateEnvelope",value:function(e){return this._validateMessageEnvelope(e).valid}},{key:"validateRequiredFields",value:function(e,t){var r,n,o,i,s,a,c,u,l,d,f,p,v=[];switch(null!==(r=e.request)&&void 0!==r&&null!==(r=r.connections)&&void 0!==r&&r.threadId||v.push("request.connections.threadId is required"),t){case"adjust":null!==(n=e.request)&&void 0!==n&&null!==(n=n.attributes)&&void 0!==n&&n.content||v.push("request.attributes.content is required for adjust"),null!==(o=e.request)&&void 0!==o&&null!==(o=o.attributes)&&void 0!==o&&o.instruction||v.push("request.attributes.instruction is required for adjust"),null!==(i=e.request)&&void 0!==i&&null!==(i=i.connections)&&void 0!==i&&i.parentId||v.push("request.connections.parentId is required for adjust"),null!==(s=e.request)&&void 0!==s&&null!==(s=s.scope)&&void 0!==s&&s.conversations&&Array.isArray(e.request.scope.conversations)&&0!==e.request.scope.conversations.length||v.push("request.scope.conversations is required for adjust and must be a non-empty array");break;case"elevate":null!==(a=e.request)&&void 0!==a&&null!==(a=a.attributes)&&void 0!==a&&a.content||v.push("request.attributes.content is required for elevate"),null!==(c=e.request)&&void 0!==c&&null!==(c=c.connections)&&void 0!==c&&c.parentId||v.push("request.connections.parentId is required for elevate"),null!==(u=e.request)&&void 0!==u&&null!==(u=u.scope)&&void 0!==u&&u.conversations&&Array.isArray(e.request.scope.conversations)&&0!==e.request.scope.conversations.length||v.push("request.scope.conversations is required for elevate and must be a non-empty array");break;case"translate":case"summarize":case"insights":null!==(l=e.request)&&void 0!==l&&null!==(l=l.scope)&&void 0!==l&&l.conversations&&Array.isArray(e.request.scope.conversations)&&0!==e.request.scope.conversations.length||v.push("request.scope.conversations is required for ".concat(t," and must be a non-empty array"));break;case"recommend":null!==(d=e.request)&&void 0!==d&&null!==(d=d.resources)&&void 0!==d&&d.offers&&Array.isArray(e.request.resources.offers)&&0!==e.request.resources.offers.length||v.push("request.resources.offers is required for recommend and must be a non-empty array"),null!==(f=e.request)&&void 0!==f&&null!==(f=f.scope)&&void 0!==f&&f.conversations&&Array.isArray(e.request.scope.conversations)&&0!==e.request.scope.conversations.length||v.push("request.scope.conversations is required for recommend and must be a non-empty array");break;case"customerinteraction":case"customerInteraction":case"interaction":null!==(p=e.request)&&void 0!==p&&null!==(p=p.scope)&&void 0!==p&&p.conversations&&Array.isArray(e.request.scope.conversations)&&0!==e.request.scope.conversations.length||v.push("request.scope.conversations is required for ".concat(t," and must be a non-empty array"))}return{isValid:0===v.length,errors:v}}},{key:"authenticate",value:(i=Ae(Oe().m(function e(){var t,r,n,o,i,s;return Oe().w(function(e){for(;;)switch(e.n){case 0:if(!se.isBrowser("browser-esm")){e.n=1;break}return this.handleError(G.AUTHENTICATION,"UNSUPPORTED_IN_BROWSER","authenticate() is not available in browsers. Use options.tokenProvider() to obtain a short-lived WebSocket token from your backend."),e.a(2,null);case 1:if(t={grant_type:"client_credentials"},this.options.authenticationUrl){e.n=2;break}return this.handleError(G.AUTHENTICATION,"INVALID_AUTHENTICATION_URL","Empty or invalid authentication URL"),e.a(2,null);case 2:if(this.options.clientId){e.n=3;break}return this.handleError(G.AUTHENTICATION,"INVALID_CLIENT_ID","Empty or invalid client ID"),e.a(2,null);case 3:return t.client_id=this.options.clientId,t.client_secret=this.options.clientSecret,r=new URLSearchParams(t).toString(),(n=this.options.authenticationUrl).endsWith("/token")||(n=n.endsWith("/")?n+"token":n+"/token"),o="".concat(n,"?").concat(r),e.n=4,fetch(o,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"}});case 4:return i=e.v,e.n=5,i.json();case 5:if(s=e.v,i.ok){e.n=6;break}return this.handleError(G.AUTHENTICATION,"INVALID_AUTHENTICATION_RESPONSE",this.formatAuthenticationError(i,s.error,"token endpoint").message,s.error),e.a(2,null);case 6:return e.a(2,s.access_token)}},e,this)})),function(){return i.apply(this,arguments)})},{key:"openConnection",value:(o=Ae(Oe().m(function e(t){var r,n,o,i,s,a,c,u,l=this;return Oe().w(function(e){for(;;)switch(e.p=e.n){case 0:if(this.options.websocketUrl){e.n=1;break}return((null===(r=this.options)||void 0===r||null===(r=r.logger)||void 0===r?void 0:r.error)||console.error)("[Optave SDK] openConnection aborted: missing websocketUrl"),this.handleError(G.WEBSOCKET,"INVALID_WEBSOCKET_URL",this.formatWebSocketError(new Error("Invalid WebSocket URL configuration"),{url:this.options.websocketUrl}).message,this.options.websocketUrl),e.a(2);case 1:return n=function(){var e=Ae(Oe().m(function e(){var r;return Oe().w(function(e){for(;;)switch(e.p=e.n){case 0:if(!("string"==typeof t&&t.length>0)){e.n=1;break}return e.a(2,t);case 1:if("function"!=typeof l.options.tokenProvider){e.n=5;break}return e.p=2,e.n=3,l.options.tokenProvider();case 3:return e.a(2,e.v);case 4:return e.p=4,r=e.v,l.handleError(G.AUTHENTICATION,"TOKEN_PROVIDER_FAILED",l.formatTokenProviderError(r).message,r),e.a(2,null);case 5:return e.a(2,null)}},e,null,[[2,4]])}));return function(){return e.apply(this,arguments)}}(),e.n=2,n();case 2:return o=e.v,e.n=3,this._ensureWebSocketImpl();case 3:if(this.WebSocketImpl){e.n=4;break}return this.handleError(G.WEBSOCKET,"NO_WEBSOCKET_IMPL",this.formatWebSocketError(new Error("No WebSocket implementation available"),{environment:"undefined"!=typeof window?"browser":"node"}).message),e.a(2);case 4:if(o||!1===this.options.authRequired){e.n=5;break}return this.handleError(G.AUTHENTICATION,"MISSING_TOKEN","No WebSocket token available. Provide options.tokenProvider() or set options.tokenUrl."),e.a(2);case 5:i=new URLSearchParams,this.sessionId&&i.set("OptaveTraceChatSessionId",this.sessionId),e.p=6,"subprotocol"===this.options.authTransport?(s=o?["optave-v1",o]:["optave-v1"],this.wss=new this.WebSocketImpl(i.toString()?"".concat(this.options.websocketUrl,"?").concat(i.toString()):this.options.websocketUrl,s)):(o&&(a=o.replace(/^Bearer\s+/i,""),i.set("Authorization",a)),this.wss=new this.WebSocketImpl(i.toString()?"".concat(this.options.websocketUrl,"?").concat(i.toString()):this.options.websocketUrl),o&&this._warnOnce("_warnedQueryToken",'[Optave SDK] Passing auth token in WebSocket URL query is discouraged. Prefer authTransport="subprotocol".')),e.n=8;break;case 7:return e.p=7,u=e.v,((null===(c=this.options)||void 0===c||null===(c=c.logger)||void 0===c?void 0:c.error)||console.error)("[Optave SDK] WebSocket constructor threw",u),this.handleError(G.WEBSOCKET,"WEBSOCKET_ERROR",this.formatWebSocketError(u,{url:this.options.websocketUrl}).message,u),e.a(2);case 8:return e.a(2,new Promise(function(e,t){var r=setTimeout(function(){var e=l.options.connectionTimeoutMs||3e4,r=l.formatWebSocketError(new Error("Connection timeout"),{timeout:e,url:l.options.websocketUrl}).message;l.handleError(G.WEBSOCKET,"CONNECTION_TIMEOUT",r),t({category:G.WEBSOCKET,code:"CONNECTION_TIMEOUT",message:r,details:null})},l.options.connectionTimeoutMs||3e4);l.wss.onopen=function(t){clearTimeout(r),l.emit("open",t),e(t)},l.wss.onmessage=function(e){l._handleInbound(e.data)},l.wss.onclose=function(e){clearTimeout(r),l.emit("close",e);var t,n=Ee(l._pending.entries());try{for(n.s();!(t=n.n()).done;){var o=Se(t.value,2),i=o[0],s=o[1];s.timer&&clearTimeout(s.timer),s._handled=!0,s.reject({category:G.WEBSOCKET,code:"CONNECTION_CLOSED",message:"WebSocket connection closed: ".concat(e.reason||"Connection lost"),details:{code:e.code,reason:e.reason,correlationId:i},correlationId:i})}}catch(e){n.e(e)}finally{n.f()}l._pending.clear(),l.wss=null},l.wss.onerror=function(e){clearTimeout(r);var n,o=e.message||(e instanceof Error?e.message:null)||"object"===ge(e)&&e.error&&e.error.message||"WebSocket connection failed",i={category:G.WEBSOCKET,code:"CONNECTION_ERROR",message:o,details:{originalError:e}},s=Ee(l._pending.entries());try{for(s.s();!(n=s.n()).done;){var a=Se(n.value,2),c=a[0],u=a[1];u.timer&&clearTimeout(u.timer),u._handled=!0,u.reject(Re(Re({},i),{},{details:Re(Re({},i.details),{},{correlationId:c}),correlationId:c}))}}catch(e){s.e(e)}finally{s.f()}l._pending.clear(),l.emit("error",i),t(i)}}))}},e,this,[[6,7]])})),function(e){return o.apply(this,arguments)})},{key:"_warnOnce",value:function(e,t){var r;this[e]||(this[e]=!0,((null===(r=this.options)||void 0===r||null===(r=r.logger)||void 0===r?void 0:r.warn)||console.warn)(t))}},{key:"deprecate",value:function(e,t){var r;this._silenceDeprecations||this._deprecatedKeys.has(e)||(this._deprecatedKeys.add(e),((null===(r=this.options)||void 0===r||null===(r=r.logger)||void 0===r?void 0:r.warn)||console.warn)(t))}},{key:"_handleInbound",value:function(e){var t,r,n,o,i,s,a;try{a="string"==typeof e?JSON.parse(e):e}catch(e){var c={category:G.WEBSOCKET,code:"INVALID_JSON",message:"Invalid JSON received from server",details:e,timestamp:(new Date).toISOString()};return void this._emitError(c)}var u=a&&a.headers&&a.payload,l="error"===(null===(t=a)||void 0===t?void 0:t.state)||"error"===(null===(r=a)||void 0===r?void 0:r.actionType)||!(null===(n=a)||void 0===n||!n.error);if(this.options.strictValidation&&u){var d=this._validateMessageEnvelope(a);d.valid||this.handleError(G.VALIDATION,"INBOUND_ENVELOPE_SCHEMA_MISMATCH",this.formatValidationErrorMessage(d.errors,"Inbound envelope validation failed"),d.errors)}if(l){var f,p,v,h,y,m,b,g=(null===(f=a)||void 0===f?void 0:f.headers)&&a.headers.correlationId||(null===(p=a)||void 0===p?void 0:p.correlationId)||null,S={category:G.ORCHESTRATOR,code:(null===(v=a)||void 0===v||null===(v=v.error)||void 0===v?void 0:v.code)||"REMOTE_ERROR",message:(null===(h=a)||void 0===h||null===(h=h.error)||void 0===h?void 0:h.message)||(null===(y=a)||void 0===y?void 0:y.message)||"Remote error",details:(null===(m=a)||void 0===m?void 0:m.error)||a,correlationId:g};if(g&&this._pending.has(g)){var E=this._pending.get(g);E.timer&&clearTimeout(E.timer),E._handled=!0,this._pending.delete(g),E.reject(S)}this._emitError(S,null===(b=a)||void 0===b?void 0:b.action)}else{var w,_=(null===(o=a)||void 0===o||null===(o=o.headers)||void 0===o?void 0:o.correlationId)||(null===(i=a)||void 0===i?void 0:i.correlationId);if(_&&this._pending.has(_)){var O=this._pending.get(_);O.timer&&clearTimeout(O.timer),O._handled=!0,this._pending.delete(_),O.resolve(a)}this.emit(x.MESSAGE,a),Me||(Me=!0,((null===(w=this.options)||void 0===w||null===(w=w.logger)||void 0===w?void 0:w.warn)||console.warn)('[optave-sdk][deprecation] The "message" event will be deprecated. Please also listen to "superpower.response".')),this.emit(F.SUPERPOWER_RESPONSE,a),this.emit(z.RESPONSE,a),null!==(s=a)&&void 0!==s&&s.action&&this.emit("message.".concat(a.action).toLowerCase(),a),u&&a.headers.schemaRef&&this.emit(a.headers.schemaRef,a)}}},{key:"_emitError",value:function(e){var t;e.timestamp||(e.timestamp=(new Date).toISOString()),this.emit(x.ERROR,e),Le||(Le=!0,((null===(t=this.options)||void 0===t||null===(t=t.logger)||void 0===t?void 0:t.warn)||console.warn)('[optave-sdk][deprecation] The "error" (string payload) is deprecated. Please also listen to "superpower.error" for a structured error object.'));var r,n=(r=e)&&r.category&&r.code&&r.message?new fe(r):"string"==typeof r?new fe({category:"UNKNOWN",code:"STRING_ERROR",message:r}):r&&r.isAuthError?new fe({category:"AUTHENTICATION",code:r.code||"AUTH_ERROR",message:r.message||"Authentication error",details:r}):r&&r.isWsError?new fe({category:"WEBSOCKET",code:r.code||"WS_ERROR",message:r.message||"WebSocket error",details:r}):new fe({category:"UNKNOWN",code:"UNCLASSIFIED",message:r&&r.message||String(null!=r?r:"Unknown error"),details:r});this.emit(F.SUPERPOWER_ERROR,n),this.emit(z.ERROR,e)}},{key:"closeConnection",value:function(){this.wss&&(this.wss.onopen=null,this.wss.onmessage=null,this.wss.onclose=null,this.wss.onerror=null,this.wss.close(),this.wss=null)}},{key:"selectiveDeepMerge",value:function(e,t){if(Array.isArray(e)&&Array.isArray(t))return be(t);var r=function(e){return null!==e&&"object"===ge(e)&&!Array.isArray(e)};if(r(e)&&r(t)){var n=Re({},e);for(var o in t)n[o]=o in e?this.selectiveDeepMerge(e[o],t[o]):t[o];return n}return void 0!==t?t:e}},{key:"isPayloadSizeValid",value:function(e){return!!e&&e.length/1024<=Y.MAX_PAYLOAD_SIZE_KB}},{key:"openConnectionAsync",value:function(e){var t=this;return new Promise(function(r,n){var o=function(e){t.off("error",i),r(e)},i=function(e){t.off("open",o),n(e)};t.once("open",o),t.once("error",i),t.openConnection(e)})}},{key:"buildPayload",value:function(t,r,n){var o,i,s,a=this.selectiveDeepMerge(e.defaultPayload,n);return null!=n&&null!==(o=n.request)&&void 0!==o&&o.variation&&(this.deprecate("payload.request.variation","[Deprecation] 'request.variation' is deprecated; use 'request.attributes.variant'."),a.request.attributes.variant=n.request.variation),null==n||null===(i=n.request)||void 0===i||!i.content||null!==(s=a.request)&&void 0!==s&&null!==(s=s.attributes)&&void 0!==s&&s.content||(a.request.attributes.content=n.request.content,this.deprecate("payload.request.content","[Deprecation] 'request.content' is deprecated; use 'request.attributes.content'.")),a.request.attributes.variant&&(a.request.attributes.variant=a.request.attributes.variant.toUpperCase()),a}},{key:"resolveMessageId",value:function(e,t){return"".concat(t,".").concat(e,".v3").toLowerCase()}},{key:"buildMessageEnvelope",value:function(e,t,r){var n,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=(new Date).toISOString(),s=o.correlationId||(null==e||null===(n=e.request)||void 0===n?void 0:n.requestId)||U(),a=o.traceId||U(),c=o.idempotencyKey||U(),u=o.timestamp,l={correlationId:s,action:r,schemaRef:K,sdkVersion:We,identifier:t,traceId:a,idempotencyKey:c,timestamp:u,issuedAt:i};return this.options.tenantId&&(l.tenantId=this.options.tenantId),void 0!==o.networkLatencyMs&&(l.networkLatencyMs=o.networkLatencyMs),Object.freeze(l),{action:"message",headers:l,payload:e}}},{key:"formatValidationErrorMessage",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Validation failed";if(!e||!Array.isArray(e)||0===e.length)return t;if(1===e.length){var r=e[0],n=r.instancePath||"/",o="/"===n?"root object":n.replace(/^\//,"").replace(/\//g,".");if("required"===r.keyword){var i,s=(null===(i=r.params)||void 0===i?void 0:i.missingProperty)||"unknown field",a="root object"===o?s:o.endsWith(s)?o:o+"."+s;return"".concat(t,": ").concat("root object"===o?"Required field":"Field"," '").concat(a,"' is missing")}if("type"===r.keyword){var c,u=(null===(c=r.params)||void 0===c?void 0:c.type)||"unknown";return"".concat(t,": Field '").concat(o,"' must be of type '").concat(u,"'")}if("additionalProperties"===r.keyword){var l,d=(null===(l=r.params)||void 0===l?void 0:l.additionalProperty)||"unknown";return"".concat(t,": Field '").concat(o,".").concat(d,"' is not allowed")}if("enum"===r.keyword){var f,p=(null===(f=r.params)||void 0===f?void 0:f.allowedValues)||[],v=Array.isArray(p)?p.join(", "):"unknown values";return"".concat(t,": Field '").concat(o,"' must be one of: ").concat(v)}return"".concat(t,": ").concat(r.message," at '").concat(o,"'")}var h=e.filter(function(e){return"required"===e.keyword}),y=e.filter(function(e){return"type"===e.keyword}),m=e.filter(function(e){return"required"!==e.keyword&&"type"!==e.keyword}),b=t+":";if(h.length>0){var g=h.map(function(e){var t,r=(e.instancePath||"/").replace(/^\//,"").replace(/\//g,"."),n=(null===(t=e.params)||void 0===t?void 0:t.missingProperty)||"unknown";return""===r?n:"".concat(r,".").concat(n)});b+=" Missing required fields: ".concat(g.join(", "),".")}if(y.length>0){var S=y.slice(0,3).map(function(e){var t,r=(e.instancePath||"/").replace(/^\//,"").replace(/\//g,"."),n=(null===(t=e.params)||void 0===t?void 0:t.type)||"unknown";return"".concat(r||"root"," (expected ").concat(n,")")});b+=" Type errors in: ".concat(S.join(", "),"."),y.length>3&&(b+=" And ".concat(y.length-3," more type errors."))}return m.length>0&&(b+=" Additional validation errors: ".concat(m.length,".")),b}},{key:"formatAuthenticationError",value:function(e,t,r){var n="Authentication failed",o=[];return e&&e.status&&(n+=" (HTTP ".concat(e.status,")")),t&&("string"==typeof t?n+=": ".concat(t):t.error_description?n+=": ".concat(t.error_description):t.message?n+=": ".concat(t.message):t.error&&(n+=": ".concat(t.error))),e&&401===e.status?(o.push("Verify clientId and clientSecret are correct"),o.push("Ensure credentials match the target environment (dev/staging/production)")):e&&403===e.status?(o.push("Check if your client has the necessary permissions"),o.push("Verify the authentication endpoint URL is correct")):e&&e.status>=500?(o.push("Authentication server error - try again later"),o.push("Contact support if the problem persists")):o.push("Check network connectivity and authentication endpoint configuration"),r&&r.authUrl&&(n+=" (endpoint: ".concat(r.authUrl,")")),{message:n,suggestions:o}}},{key:"formatWebSocketError",value:function(e,t){var r="WebSocket connection failed",n=[],o=(null==e?void 0:e.message)||(e instanceof Error?e.message:null)||"object"===ge(e)&&e.error&&e.error.message||null;return o&&(r+=": ".concat(o)),t&&(t.url&&(r+=" (URL: ".concat(t.url,")")),t.timeout&&(r+=" (timeout: ".concat(t.timeout,"ms)"))),n.push("Check network connectivity and firewall settings"),n.push("Verify WebSocket URL is correct and accessible"),t&&t.url&&(t.url.startsWith("ws://")&&n.push("Consider using secure WebSocket (wss://) for production"),(t.url.includes("localhost")||t.url.includes("127.0.0.1"))&&n.push("Ensure local server is running if connecting to localhost")),t&&t.timeout&&n.push("Try increasing connection timeout if network is slow"),{message:r,suggestions:n}}},{key:"formatPayloadSizeError",value:function(e,t,r){var n=Math.ceil(e/1024),o=t,i=n-o,s="Payload too large: ".concat(n,"KB exceeds maximum ").concat(o,"KB (").concat(i,"KB over limit)"),a=[];if(r&&"object"===ge(r)){var c,u,l;if(JSON.stringify(r),null!==(c=r.request)&&void 0!==c&&null!==(c=c.scope)&&void 0!==c&&c.conversations&&Array.isArray(r.request.scope.conversations)){var d=JSON.stringify(r.request.scope.conversations).length,f=Math.ceil(d/1024);f>10&&(a.push("Consider reducing conversation history - current size: ~".concat(f,"KB")),a.push("Remove older messages or summarize conversation context"))}if(null!==(u=r.request)&&void 0!==u&&null!==(u=u.resources)&&void 0!==u&&u.offers&&Array.isArray(r.request.resources.offers)){var p=JSON.stringify(r.request.resources.offers).length,v=Math.ceil(p/1024);v>5&&a.push("Consider reducing product offers data - current size: ~".concat(v,"KB"))}if(null!==(l=r.session)&&void 0!==l&&null!==(l=l.channel)&&void 0!==l&&l.metadata&&Array.isArray(r.session.channel.metadata)){var h=JSON.stringify(r.session.channel.metadata).length,y=Math.ceil(h/1024);y>2&&a.push("Consider reducing metadata array - current size: ~".concat(y,"KB"))}}return 0===a.length&&(a.push("Remove unused fields from request payload"),a.push("Consider paginating large datasets"),a.push("Use shorter field values where possible")),{message:s,suggestions:a}}},{key:"formatTokenProviderError",value:function(e,t){var r,n,o,i,s,a,c="Failed to obtain WebSocket token from tokenProvider()",u=[];return e&&(e.message?c+=": ".concat(e.message):"string"==typeof e&&(c+=": ".concat(e)),"TypeError"===e.name&&null!==(r=e.message)&&void 0!==r&&r.includes("fetch")?(u.push("Check if tokenProvider endpoint is accessible"),u.push("Verify CORS settings allow requests to token endpoint")):null!==(n=e.message)&&void 0!==n&&n.includes("404")||null!==(o=e.message)&&void 0!==o&&o.includes("Not Found")?(u.push("Verify tokenProvider endpoint URL is correct"),u.push("Ensure backend token endpoint is implemented")):null!==(i=e.message)&&void 0!==i&&i.includes("401")||null!==(s=e.message)&&void 0!==s&&s.includes("403")?(u.push("Check authentication/authorization for token endpoint"),u.push("Verify user session or credentials are valid")):null!==(a=e.message)&&void 0!==a&&a.includes("timeout")&&u.push("Token provider request timed out - check network or server response time")),t&&t.tokenUrl&&(c+=" (endpoint: ".concat(t.tokenUrl,")")),0===u.length&&(u.push("Verify tokenProvider function implementation"),u.push("Check backend token endpoint is running and accessible"),u.push("Review browser console for network errors")),{message:c,suggestions:u}}},{key:"handleError",value:function(e,t,r){var n,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,s=new fe({category:e,code:t,message:r,details:arguments.length>3&&void 0!==arguments[3]?arguments[3]:null});o&&(s.suggestions=o),i&&(s.correlationId=i),0===this.listenerCount(x.ERROR)&&0===this.listenerCount(z.ERROR)&&((null===(n=this.options)||void 0===n||null===(n=n.logger)||void 0===n?void 0:n.error)||console.error)("[Optave SDK] ".concat(t,": ").concat(r)),this._emitError(s)}},{key:"send",value:function(e,t,r){var n=null!=(this.WebSocketImpl&&this.WebSocketImpl.OPEN)?this.WebSocketImpl.OPEN:1;if(this.wss&&this.wss.readyState===n)if(H.has(t)){for(var o=new Set(["session","request","headers"]),i=0,s=Object.keys(r||{});i<s.length;i++){var a=s[i];if(!o.has(a)){var c=[{instancePath:"",keyword:"additionalProperties",params:{additionalProperty:a},message:"must NOT have additional property '".concat(a,"'")}];return void this.handleError(G.VALIDATION,"PAYLOAD_SCHEMA_MISMATCH",this.formatValidationErrorMessage(c),c)}}var u=this.buildPayload(e,t,r||{}),l=this.validateRequiredFields(u||{},t);if(l.isValid){if(this.options.strictValidation){var d=this._validatePayload(u);if(!d.valid)return void this.handleError(G.VALIDATION,"PAYLOAD_SCHEMA_MISMATCH",this.formatValidationErrorMessage(d.errors,"Schema validation failed"),d.errors)}var f=this.buildMessageEnvelope(u,e,t,(null==r?void 0:r.headers)||{}),p=JSON.stringify(f);if(this.isPayloadSizeValid(p))this.wss.send(p);else{var v=p.length;this.handleError(G.VALIDATION,"PAYLOAD_TOO_LARGE",this.formatPayloadSizeError(v,Y.MAX_PAYLOAD_SIZE_KB,f).message,Y.MAX_PAYLOAD_SIZE_KB)}}else this.handleError(G.VALIDATION,"REQUIRED_FIELDS_MISSING","Missing required fields for action '".concat(t,"': ").concat(l.errors.join(", ")),l.errors)}else this.handleError(G.VALIDATION,"INVALID_ACTION","Unsupported action '".concat(t,"'. Allowed: ").concat(be(H).join(", ")));else{var h=this.wss?this.wss.readyState:"no connection";this.handleError(G.WEBSOCKET,"WEBSOCKET_NOT_IN_OPEN_STATE",this.formatWebSocketError(new Error("WebSocket not ready for sending"),{readyState:h,action:t}).message)}}},{key:"adjust",value:function(e){return this.send("message","adjust",e)}},{key:"elevate",value:function(e){return this.send("message","elevate",e)}},{key:"interaction",value:function(e){return this.send("message","interaction",e)}},{key:"reception",value:function(e){return this.send("message","reception",e)}},{key:"customerInteraction",value:function(e){return this.deprecate("method.customerInteraction","[Deprecation] 'customerInteraction' is deprecated; use 'interaction' instead."),this.send("message","customerInteraction",e)}},{key:"summarize",value:function(e){return this.send("message","summarize",e)}},{key:"translate",value:function(e){return this.send("message","translate",e)}},{key:"recommend",value:function(e){return this.send("message","recommend",e)}},{key:"insights",value:function(e){return this.send("message","insights",e)}},{key:"_registerPending",value:function(e,t,r,n,o){var i=this,s=null;r>0&&(s=setTimeout(function(){if(i._pending.has(e)){var n=i._pending.get(e);n&&!n._handled&&(i._pending.delete(e),n._handled=!0,o({category:G.WEBSOCKET,code:"REQUEST_TIMEOUT",message:"Request timed out after ".concat(r,"ms"),details:{correlationId:e,action:t},correlationId:e}))}},r)),this._pending.set(e,{resolve:n,reject:o,timer:s,action:t,_handled:!1})}},{key:"_promiseSend",value:function(e,t){var r,n=this,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},s=new Promise(function(s,a){var c="number"==typeof i.timeoutMs?i.timeoutMs:"number"==typeof i.timeout?i.timeout:n.options.requestTimeoutMs;if(!n.wss||n.wss.readyState!==WebSocket.OPEN){if(c<=0)return void a({category:G.WEBSOCKET,code:"WEBSOCKET_NOT_IN_OPEN_STATE",message:"WebSocket not open",details:null});var u=n.buildPayload(e,t,o),l=n.buildMessageEnvelope(u,e,t,(null==o?void 0:o.headers)||{});return r=l.headers.correlationId,void n._registerPending(r,t,c,s,a)}if(H.has(t)){for(var d=new Set(["session","request","headers"]),f=0,p=Object.keys(o||{});f<p.length;f++){var v=p[f];if(!d.has(v)){var h=[{instancePath:"",keyword:"additionalProperties",params:{additionalProperty:v},message:"must NOT have additional property '".concat(v,"'")}];return void a({category:G.VALIDATION,code:"PAYLOAD_SCHEMA_MISMATCH",message:n.formatValidationErrorMessage(h),details:h})}}var y=n.buildPayload(e,t,o),m=n.validateRequiredFields(y,t);if(m.isValid){if(n.options.strictValidation){var b=M(y);if(!b.valid)return void a({category:G.VALIDATION,code:"PAYLOAD_SCHEMA_MISMATCH",message:n.formatValidationErrorMessage(b.errors,"Schema validation failed"),details:b.errors})}var g=n.buildMessageEnvelope(y,e,t,(null==o?void 0:o.headers)||{});r=g.headers.correlationId,n._registerPending(r,t,c,s,a);var S=JSON.stringify(g);if(n.isPayloadSizeValid(S))try{n.wss.send(S)}catch(e){if(n._pending.has(r)){var E=n._pending.get(r);E.timer&&clearTimeout(E.timer),E._handled=!0,n._pending.delete(r)}a({category:G.WEBSOCKET,code:"SEND_FAILED",message:"Failed to send over WebSocket",details:e,correlationId:r})}else{var w=S.length,_=n.formatPayloadSizeError(w,Y.MAX_PAYLOAD_SIZE_KB,g).message;a({category:G.VALIDATION,code:"PAYLOAD_TOO_LARGE",message:_,details:{maxKb:Y.MAX_PAYLOAD_SIZE_KB}})}}else a({category:G.VALIDATION,code:"REQUIRED_FIELDS_MISSING",message:"Missing required fields for action '".concat(t,"'"),details:m.errors})}else a({category:G.VALIDATION,code:"INVALID_ACTION",message:"Unsupported action '".concat(t,"'."),details:{allowed:be(H)}})});return s.correlationId=r,s}},{key:"adjustAsync",value:function(e,t){return this._promiseSend("message","adjust",e,t)}},{key:"elevateAsync",value:function(e,t){return this._promiseSend("message","elevate",e,t)}},{key:"interactionAsync",value:function(e,t){return this._promiseSend("message","interaction",e,t)}},{key:"receptionAsync",value:function(e,t){return this._promiseSend("message","reception",e,t)}},{key:"customerInteractionAsync",value:function(e,t){return this.deprecate("method.customerInteractionAsync","[Deprecation] 'customerInteractionAsync' is deprecated; use 'interactionAsync' instead."),this._promiseSend("message","customerInteraction",e,t)}},{key:"summarizeAsync",value:function(e,t){return this._promiseSend("message","summarize",e,t)}},{key:"translateAsync",value:function(e,t){return this._promiseSend("message","translate",e,t)}},{key:"recommendAsync",value:function(e,t){return this._promiseSend("message","recommend",e,t)}},{key:"insightsAsync",value:function(e,t){return this._promiseSend("message","insights",e,t)}},{key:"cancelRequest",value:function(e){if(this._pending.has(e)){var t=this._pending.get(e);return t.timer&&clearTimeout(t.timer),t._handled=!0,this._pending.delete(e),setTimeout(function(){t.reject({category:G.WEBSOCKET,code:"REQUEST_CANCELLED",message:"Request was cancelled",details:{correlationId:e},correlationId:e})},0),!0}return!1}},{key:"cancelPendingRequests",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this._pending)return 0;var t,r=this._pending.size,n=Ee(be(this._pending.entries()));try{var o=function(){var r=Se(t.value,2),n=r[0],o=r[1];o.timer&&clearTimeout(o.timer),o._handled=!0,e?o.reject({category:G.WEBSOCKET,code:"REQUEST_CANCELLED",message:"Request was cancelled during cleanup",details:{correlationId:n},correlationId:n}):queueMicrotask(function(){o.reject({category:G.WEBSOCKET,code:"REQUEST_CANCELLED",message:"Request was cancelled",details:{correlationId:n},correlationId:n})})};for(n.s();!(t=n.n()).done;)o()}catch(e){n.e(e)}finally{n.f()}return this._pending.clear(),r}},{key:"cleanup",value:function(){if(this.closeConnection(),this.cancelPendingRequests(!0),this._deprecatedKeys&&this._deprecatedKeys.clear(),void 0!==this._warnedQueryToken&&delete this._warnedQueryToken,this._events)for(var e in this._events)delete this._events[e];if(this.removeAllListeners(),this._events=null,this._eventsCount=null,this._maxListeners=null,this.constructor._preservedJSDOM&&this.constructor._preservedJSDOM.dom)try{var t=this.constructor._preservedJSDOM.dom.window;t&&"function"==typeof t.close&&t.close(),delete this.constructor._preservedJSDOM}catch(e){}this._validatePayload=null,this._validateMessageEnvelope=null,this._emitError=null,this._ensureWebSocketImpl=null,this._handleInbound=null,this._promiseSend=null,this._registerPending=null,this._warnOnce=null,this.options=null,this.WebSocketImpl=null,this.wss=null,this.sessionId=null,this._pending=null,this._deprecatedKeys=null,this._silenceDeprecations=null,this._events=null,this._eventsCount=null,this._maxListeners=null}},{key:"removeAllListeners",value:function(e){try{u.prototype.removeAllListeners.call(this,e)}catch(t){e?this._events&&this._events[e]&&(delete this._events[e],this._eventsCount=Math.max(0,this._eventsCount-1)):(this._events=Object.create(null),this._eventsCount=0)}return this}}],n=[{key:"cleanup",value:function(){Me=!1,Le=!1}},{key:"getSdkVersion",value:function(){return We}},{key:"getSpecVersion",value:function(){return V}},{key:"getSchemaRef",value:function(){return K}},{key:"CONSTANTS",get:function(){return Y}},{key:"LegacyEvents",get:function(){return x}},{key:"InboundEvents",get:function(){return F}},{key:"buildFlags",get:function(){var e="browser-esm";return{SALESFORCE_BUILD:"undefined"!=typeof __SALESFORCE_BUILD__&&__SALESFORCE_BUILD__,INCLUDE_WS_REQUIRE:!1,SDK_VERSION:"3.2.1",WEBPACK_BUILD_TARGET:e,WEBPACK_BUILD_TARGET_NORMALIZED:se.normalize(e),BUILD_TARGET_INFO:se.getInfo(e)}}}],r&&qe(t.prototype,r),n&&qe(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,r,n,o,i,s,a}();Ne(Ve,"defaultPayload",{session:{sessionId:"",channel:{browser:"",deviceInfo:"",deviceType:"",language:"",location:"",medium:"chat",metadata:[],section:""},interface:{appVersion:"",category:"",language:"",name:"",type:""}},request:{requestId:"",attributes:{content:"",instruction:"",variant:"A"},connections:{journeyId:"",parentId:"",threadId:""},context:{caseId:"",departmentId:"",operatorId:"",organizationId:"",userId:""},reference:{ids:[{name:"",value:""}],labels:[],tags:[]},resources:{codes:[{id:"",label:"",type:"",value:""}],links:[{expires_at:"",html:!1,id:"",label:"",type:"",url:""}],offers:[]},scope:{accounts:[],appointments:[],assets:[],bookings:[],cases:[],conversations:[],documents:[],events:[],interactions:[],items:[],locations:[],operators:[],orders:[],organizations:[],persons:[],policies:[],products:[{id:""}],properties:[],services:[],subscriptions:[],tickets:[],transactions:[],users:[]},settings:{disableBrowsing:!1,disableSearch:!1,disableSources:!1,disableStream:!0,disableTools:!1,maxResponseLength:0,overrideInterfaceLanguage:"",overrideOutputLanguage:""},a2a:[{id:"",name:"",type:""}],cursor:{since:"",until:""}}});const Be=Ve;export{Be as default};