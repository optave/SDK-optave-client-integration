!function webpackUniversalModuleDefinition(root,factory){"object"==typeof exports&&"object"==typeof module?module.exports=factory():"function"==typeof define&&define.amd?define("OptaveJavaScriptSDK",[],factory):"object"==typeof exports?exports.OptaveJavaScriptSDK=factory():root.OptaveJavaScriptSDK=factory()}(function(){return"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:this}(),()=>(()=>{var e={746:(e,t,r)=>{function n(e){if(null!=e){var t=e["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],r=0;if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length))return{next:function t(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}}throw new TypeError(a(e)+" is not iterable")}function o(){var e,t,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",s=r.toStringTag||"@@toStringTag";function a(r,n,o,s){var a=n&&n.prototype instanceof c?n:c,l=Object.create(a.prototype);return i(l,"_invoke",function(r,n,o){var i,s,a,c=0,l=o||[],d=!1,f={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function t(r,n){return i=r,s=0,a=e,f.n=n,u}};function p(r,n){for(s=r,a=n,t=0;!d&&c&&!o&&t<l.length;t++){var o,i=l[t],p=f.p,v=i[2];r>3?(o=v===n)&&(a=i[(s=i[4])?5:(s=3,3)],i[4]=i[5]=e):i[0]<=p&&((o=r<2&&p<i[1])?(s=0,f.v=n,f.n=i[1]):p<v&&(o=r<3||i[0]>n||n>v)&&(i[4]=r,i[5]=n,f.n=v,s=0))}if(o||r>1)return u;throw d=!0,n}return function(o,l,v){if(c>1)throw TypeError("Generator is already running");for(d&&1===l&&p(l,v),s=l,a=v;(t=s<2?e:a)||!d;){i||(s?s<3?(s>1&&(f.n=-1),p(s,a)):f.n=a:f.v=a);try{if(c=2,i){if(s||(o="next"),t=i[o]){if(!(t=t.call(i,a)))throw TypeError("iterator result is not an object");if(!t.done)return t;a=t.value,s<2&&(s=0)}else 1===s&&(t=i.return)&&t.call(i),s<2&&(a=TypeError("The iterator does not provide a '"+o+"' method"),s=1);i=e}else if((t=(d=f.n<0)?a:r.call(n,f))!==u)break}catch(t){i=e,s=1,a=t}finally{c=1}}return{value:t,done:d}}}(r,o,s),!0),l}var u={};function c(){}function l(){}function d(){}t=Object.getPrototypeOf;var f=[][n]?t(t([][n]())):(i(t={},n,function(){return this}),t),p=d.prototype=c.prototype=Object.create(f);function v(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,i(e,s,"GeneratorFunction")),e.prototype=Object.create(p),e}return l.prototype=d,i(p,"constructor",d),i(d,"constructor",l),l.displayName="GeneratorFunction",i(d,s,"GeneratorFunction"),i(p),i(p,s,"Generator"),i(p,n,function(){return this}),i(p,"toString",function(){return"[object Generator]"}),(o=function e(){return{w:a,m:v}})()}function i(e,t,r,n){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}i=function e(t,r,n,s){function a(e,r){i(t,e,function(t){return this._invoke(e,r,t)})}r?o?o(t,r,{value:n,enumerable:!s,configurable:!s,writable:!s}):t[r]=n:(a("next",0),a("throw",1),a("return",2))},i(e,t,r,n)}function s(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=l(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function e(){};return{s:o,n:function t(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function e(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,a=!1;return{s:function t(){r=r.call(e)},n:function e(){var t=r.next();return s=t.done,t},e:function e(t){a=!0,i=t},f:function e(){try{s||null==r.return||r.return()}finally{if(a)throw i}}}}function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}function u(e,t){return p(e)||f(e,t)||l(e,t)||c()}function c(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function l(e,t){if(e){if("string"==typeof e)return d(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?d(e,t):void 0}}function d(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function f(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,i,s,a=[],u=!0,c=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=i.call(r)).done)&&(a.push(n.value),a.length!==t);u=!0);}catch(e){c=!0,o=e}finally{try{if(!u&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(c)throw o}}return a}}function p(e){if(Array.isArray(e))return e}function v(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function y(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,m(n.key),n)}}function h(e,t,r){return t&&y(e.prototype,t),r&&y(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function m(e){var t=b(e,"string");return"symbol"==a(t)?t:t+""}function b(e,t){if("object"!=a(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=a(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}r.d(t,{I:()=>S});var g=function(){function e(t){var r=this,n;(v(this,e),this.params=new Map,"string"==typeof t)?t.replace(/^\?/,"").split("&").forEach(function(e){if(e){var t,n=u(e.split("="),2),o=n[0],i=n[1];o&&r.params.set(decodeURIComponent(o),decodeURIComponent(i||""))}}):t&&"object"===a(t)&&(t instanceof Map?t.forEach(function(e,t){r.params.set(t,String(e))}):Array.isArray(t)?t.forEach(function(e){var t=u(e,2),n=t[0],o=t[1];r.params.set(n,String(o))}):Object.entries(t).forEach(function(e){var t=u(e,2),n=t[0],o=t[1];r.params.set(n,String(o))}))}return h(e,[{key:"append",value:function e(t,r){var n=this.params.get(t);void 0!==n?this.params.set(t,n+","+String(r)):this.params.set(t,String(r))}},{key:"delete",value:function e(t){this.params.delete(t)}},{key:"get",value:function e(t){return this.params.get(t)||null}},{key:"getAll",value:function e(t){var r=this.params.get(t);return r?r.split(","):[]}},{key:"has",value:function e(t){return this.params.has(t)}},{key:"set",value:function e(t,r){this.params.set(t,String(r))}},{key:"toString",value:function e(){var t=[];return this.params.forEach(function(e,r){var n;e.split(",").forEach(function(e){t.push("".concat(encodeURIComponent(r),"=").concat(encodeURIComponent(e)))})}),t.join("&")}},{key:Symbol.iterator,value:o().m(function e(){var t,r,n,i,e,a,c,l,d,f,p;return o().w(function(o){for(;;)switch(o.p=o.n){case 0:t=s(this.params),o.p=1,t.s();case 2:if((r=t.n()).done){o.n=10;break}n=u(r.value,2),i=n[0],e=n[1],a=e.split(","),c=s(a),o.p=3,c.s();case 4:if((l=c.n()).done){o.n=6;break}return d=l.value,o.n=5,[i,d];case 5:o.n=4;break;case 6:o.n=8;break;case 7:o.p=7,f=o.v,c.e(f);case 8:return o.p=8,c.f(),o.f(8);case 9:o.n=2;break;case 10:o.n=12;break;case 11:o.p=11,p=o.v,t.e(p);case 12:return o.p=12,t.f(),o.f(12);case 13:return o.a(2)}},e,this,[[3,7,8,9],[1,11,12,13]])})},{key:"keys",value:o().m(function e(){var t,r,n,i,a;return o().w(function(e){for(;;)switch(e.p=e.n){case 0:t=s(this),e.p=1,t.s();case 2:if((r=t.n()).done){e.n=4;break}return n=u(r.value,1),i=n[0],e.n=3,i;case 3:e.n=2;break;case 4:e.n=6;break;case 5:e.p=5,a=e.v,t.e(a);case 6:return e.p=6,t.f(),e.f(6);case 7:return e.a(2)}},e,this,[[1,5,6,7]])})},{key:"values",value:o().m(function e(){var t,r,n,i,a;return o().w(function(e){for(;;)switch(e.p=e.n){case 0:t=s(this),e.p=1,t.s();case 2:if((r=t.n()).done){e.n=4;break}return n=u(r.value,2),i=n[1],e.n=3,i;case 3:e.n=2;break;case 4:e.n=6;break;case 5:e.p=5,a=e.v,t.e(a);case 6:return e.p=6,t.f(),e.f(6);case 7:return e.a(2)}},e,this,[[1,5,6,7]])})},{key:"entries",value:o().m(function e(){return o().w(function(e){for(;;)switch(e.n){case 0:return e.d(n(this),1);case 1:return e.a(2)}},e,this)})},{key:"forEach",value:function e(t,r){var n=s(this),o;try{for(n.s();!(o=n.n()).done;){var i=u(o.value,2),a=i[0],c=i[1];t.call(r,c,a,this)}}catch(e){n.e(e)}finally{n.f()}}}])}(),S="undefined"!=typeof globalThis&&globalThis.URLSearchParams||"undefined"!=typeof window&&window.URLSearchParams||g}},t={};function r(n){var o=t[n];if(void 0!==o)return o.exports;var i=t[n]={exports:{}};return e[n](i,i.exports,r),i.exports}void(r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var n={};function o(e){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o(e)}function i(e){return c(e)||u(e)||a(e)||s()}function s(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function a(e,t){if(e){if("string"==typeof e)return l(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?l(e,t):void 0}}function u(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function c(e){if(Array.isArray(e))return l(e)}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function d(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function f(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,v(n.key),n)}}function p(e,t,r){return t&&f(e.prototype,t),r&&f(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function v(e){var t=y(e,"string");return"symbol"==o(t)?t:t+""}function y(e,t){if("object"!=o(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=o(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function h(e,t,r){return t=k(t),m(e,E()?Reflect.construct(t,r||[],k(e).constructor):t.apply(e,r))}function m(e,t){if(t&&("object"==o(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return b(e)}function b(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function g(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&O(e,t)}function S(e){var t="function"==typeof Map?new Map:void 0;return S=function e(r){if(null===r||!_(r))return r;if("function"!=typeof r)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(r))return t.get(r);t.set(r,n)}function n(){return w(r,arguments,k(this).constructor)}return n.prototype=Object.create(r.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),O(n,r)},S(e)}function w(e,t,r){if(E())return Reflect.construct.apply(null,arguments);var n=[null];n.push.apply(n,t);var o=new(e.bind.apply(e,n));return r&&O(o,r.prototype),o}function E(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(E=function t(){return!!e})()}function _(e){try{return-1!==Function.toString.call(e).indexOf("[native code]")}catch(t){return"function"==typeof e}}function O(e,t){return O=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},O(e,t)}function k(e){return k=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},k(e)}r.d(n,{default:()=>Qt});var I=function(e){function t(){var e;return d(this,t),(e=h(this,t))._events={},e._eventsCount=0,e}return g(t,e),p(t,[{key:"on",value:function e(t,r){this._events[t]||(this._events[t]=[]),this._events[t].push(r),this._eventsCount++;var n=function e(t){t.detail&&Array.isArray(t.detail)?r.apply(void 0,i(t.detail)):r(t.detail||t)};return r._wrapped=n,this.addEventListener(t,n),this}},{key:"off",value:function e(t,r){if(this._events[t]){var n=this._events[t].indexOf(r);n>-1&&(this._events[t].splice(n,1),this._eventsCount--,0===this._events[t].length&&delete this._events[t])}return r._wrapped&&(this.removeEventListener(t,r._wrapped),delete r._wrapped),this}},{key:"removeListener",value:function e(t,r){return this.off(t,r)}},{key:"emit",value:function e(t){for(var r=arguments.length,n=new Array(r>1?r-1:0),o=1;o<r;o++)n[o-1]=arguments[o];var i=new CustomEvent(t,{detail:n});return this.dispatchEvent(i),this}},{key:"once",value:function e(t,r){var n=this,o=function e(){n.off(t,o),r.apply(void 0,arguments)};return this.on(t,o)}},{key:"listenerCount",value:function e(t){return this._events[t]?this._events[t].length:0}},{key:"removeAllListeners",value:function e(t){var r=this;if(t){if(this._events[t]){var n=this._events[t].length;this._events[t].forEach(function(e){e._wrapped&&(r.removeEventListener(t,e._wrapped),delete e._wrapped)}),delete this._events[t],this._eventsCount=Math.max(0,this._eventsCount-n)}}else{var o=Object.values(this._events).reduce(function(e,t){return e+t.length},0);Object.keys(this._events).forEach(function(e){return r.removeAllListeners(e)}),this._eventsCount=0}return this}}])}(S(EventTarget));let T;const A=new Uint8Array(16);function R(){if(!T){if("undefined"==typeof crypto||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");T=crypto.getRandomValues.bind(crypto)}return T(A)}const j=[];for(let e=0;e<256;++e)j.push((e+256).toString(16).slice(1));function P(e,t=0){return(j[e[t+0]]+j[e[t+1]]+j[e[t+2]]+j[e[t+3]]+"-"+j[e[t+4]]+j[e[t+5]]+"-"+j[e[t+6]]+j[e[t+7]]+"-"+j[e[t+8]]+j[e[t+9]]+"-"+j[e[t+10]]+j[e[t+11]]+j[e[t+12]]+j[e[t+13]]+j[e[t+14]]+j[e[t+15]]).toLowerCase()}function q(e,t=0){const r=P(e,t);if(!validate(r))throw TypeError("Stringified UUID is invalid");return r}const C=null,N={};function U(e,t,r){let n;if(e)n=D(e.random??e.rng?.()??R(),e.msecs,e.seq,t,r);else{const e=Date.now(),o=R();M(N,e,o),n=D(o,N.msecs,N.seq,t,r)}return t??P(n)}function M(e,t,r){return e.msecs??=-1/0,e.seq??=0,t>e.msecs?(e.seq=r[6]<<23|r[7]<<16|r[8]<<8|r[9],e.msecs=t):(e.seq=e.seq+1|0,0===e.seq&&e.msecs++),e}function D(e,t,r,n,o=0){if(e.length<16)throw new Error("Random bytes length must be >= 16");if(n){if(o<0||o+16>n.length)throw new RangeError(`UUID byte range ${o}:${o+15} is out of buffer bounds`)}else n=new Uint8Array(16),o=0;return t??=Date.now(),r??=127*e[6]<<24|e[7]<<16|e[8]<<8|e[9],n[o++]=t/1099511627776&255,n[o++]=t/4294967296&255,n[o++]=t/16777216&255,n[o++]=t/65536&255,n[o++]=t/256&255,n[o++]=255&t,n[o++]=112|r>>>28&15,n[o++]=r>>>20&255,n[o++]=128|r>>>14&63,n[o++]=r>>>6&255,n[o++]=r<<2&255|3&e[10],n[o++]=e[11],n[o++]=e[12],n[o++]=e[13],n[o++]=e[14],n[o++]=e[15],n}const W=U;function L(e){return L="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},L(e)}
/**
 * Browser-compatible validator implementation
 * Provides comprehensive validation without AJV dependency
 * This implementation must match the server-side validation logic for security
 */function V(e,t){var r,n;return{instancePath:e,message:t,keyword:arguments.length>2&&void 0!==arguments[2]?arguments[2]:"validation",params:arguments.length>3&&void 0!==arguments[3]?arguments[3]:{}}}function B(e){if(!e||"object"!==L(e))return{valid:!1,errors:[V("","must be object","type",{type:"object"})]};var t=[];return e.session?"object"!==L(e.session)?t.push(V("/session","must be object","type",{type:"object"})):void 0!==e.session.sessionId&&"string"!=typeof e.session.sessionId&&t.push(V("/session/sessionId","must be string","type",{type:"string"})):t.push(V("/session","is required","required",{missingProperty:"session"})),e.request?"object"!==L(e.request)?t.push(V("/request","must be object","type",{type:"object"})):(e.request.connections?"object"!==L(e.request.connections)?t.push(V("/request/connections","must be object","type",{type:"object"})):(e.request.connections.threadId?"string"!=typeof e.request.connections.threadId&&t.push(V("/request/connections/threadId","must be string","type",{type:"string"})):t.push(V("/request/connections/threadId","is required","required",{missingProperty:"threadId"})),void 0!==e.request.connections.parentId&&"string"!=typeof e.request.connections.parentId&&t.push(V("/request/connections/parentId","must be string","type",{type:"string"}))):t.push(V("/request/connections","is required","required",{missingProperty:"connections"})),void 0!==e.request.context&&"object"!==L(e.request.context)&&t.push(V("/request/context","must be object","type",{type:"object"})),void 0!==e.request.attributes&&"object"!==L(e.request.attributes)&&t.push(V("/request/attributes","must be object","type",{type:"object"})),void 0!==e.request.scope&&("object"!==L(e.request.scope)?t.push(V("/request/scope","must be object","type",{type:"object"})):void 0!==e.request.scope.conversations&&(Array.isArray(e.request.scope.conversations)||t.push(V("/request/scope/conversations","must be array","type",{type:"array"})))),void 0!==e.request.resources&&("object"!==L(e.request.resources)?t.push(V("/request/resources","must be object","type",{type:"object"})):void 0!==e.request.resources.offers&&(Array.isArray(e.request.resources.offers)||t.push(V("/request/resources/offers","must be array","type",{type:"array"}))))):t.push(V("/request","is required","required",{missingProperty:"request"})),t.length>0?{valid:!1,errors:t}:{valid:!0,errors:null}}function K(e){if(!e||"object"!==L(e))return{valid:!1,errors:[V("","must be object","type",{type:"object"})]};var t=[];if(e.headers)if("object"!==L(e.headers))t.push(V("/headers","must be object","type",{type:"object"}));else{if(e.headers.correlationId?"string"!=typeof e.headers.correlationId&&t.push(V("/headers/correlationId","must be string","type",{type:"string"})):t.push(V("/headers/correlationId","is required","required",{missingProperty:"correlationId"})),e.headers.action)if("string"!=typeof e.headers.action)t.push(V("/headers/action","must be string","type",{type:"string"}));else{var r=["adjust","elevate","interaction","customerinteraction","reception","summarize","translate","recommend","insights"];r.includes(e.headers.action)||t.push(V("/headers/action","must be equal to one of the allowed values","enum",{allowedValues:r}))}else t.push(V("/headers/action","is required","required",{missingProperty:"action"}));void 0!==e.headers.identifier&&"string"!=typeof e.headers.identifier&&t.push(V("/headers/identifier","must be string","type",{type:"string"})),void 0!==e.headers.schemaRef&&"string"!=typeof e.headers.schemaRef&&t.push(V("/headers/schemaRef","must be string","type",{type:"string"})),void 0!==e.headers.timestamp&&"string"!=typeof e.headers.timestamp&&t.push(V("/headers/timestamp","must be string","type",{type:"string"}))}else t.push(V("/headers","is required","required",{missingProperty:"headers"}));if(e.payload){if("object"!==L(e.payload))t.push(V("/payload","must be object","type",{type:"object"}));else if(e.headers&&e.headers.action&&e.payload){var n=e.headers.action,o;["adjust","elevate","interaction","customerinteraction","customerInteraction","summarize","translate","insights","recommend"].includes(n)&&(e.payload.request?e.payload.request.scope?e.payload.request.scope.conversations?Array.isArray(e.payload.request.scope.conversations)?0===e.payload.request.scope.conversations.length&&t.push(V("/payload/request/scope/conversations","must be non-empty array for ".concat(n),"minItems",{limit:1})):t.push(V("/payload/request/scope/conversations","must be array","type",{type:"array"})):t.push(V("/payload/request/scope/conversations","is required for ".concat(n),"required",{missingProperty:"conversations"})):t.push(V("/payload/request/scope","is required","required",{missingProperty:"scope"})):t.push(V("/payload/request","is required","required",{missingProperty:"request"})))}}else t.push(V("/payload","is required","required",{missingProperty:"payload"}));return t.length>0?{valid:!1,errors:t}:{valid:!0,errors:null}}var x=null,G="3.2.1",F=G.split(".")[0],z="optave.message.v".concat(F),H={AUTHENTICATION:"AUTHENTICATION",ORCHESTRATOR:"ORCHESTRATOR",VALIDATION:"VALIDATION",WEBSOCKET:"WEBSOCKET"},Y=Object.freeze({MESSAGE:"message",ERROR:"error"}),J=Object.freeze({CONNECTION_OPEN:"connection:open",CONNECTION_CLOSE:"connection:close",CONNECTION_ERROR:"connection:error",MESSAGE_RECEIVED:"message:received",MESSAGE_SENT:"message:sent",ERROR:"error",RESPONSE:"response",LEGACY_ERROR:"error",LEGACY_MESSAGE:"message"}),Q=Object.freeze({SUPERPOWER_RESPONSE:"superpower.response",SUPERPOWER_ERROR:"superpower.error"}),X=new Set(["adjust","elevate","interaction","reception","customerInteraction","summarize","translate","recommend","insights"]),Z,$,ee,te;const re={SPEC_VERSION:G,SCHEMA_REF:z,MAX_PAYLOAD_SIZE:131072,MAX_PAYLOAD_SIZE_KB:128,DEFAULT_REQUEST_TIMEOUT_MS:3e4,ErrorCategory:H,LegacyEvents:Y,EVENTS:J,InboundEvents:Q,ALLOWED_ACTIONS:X};function ne(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=se(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function e(){};return{s:o,n:function t(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function e(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,a=!1;return{s:function t(){r=r.call(e)},n:function e(){var t=r.next();return s=t.done,t},e:function e(t){a=!0,i=t},f:function e(){try{s||null==r.return||r.return()}finally{if(a)throw i}}}}function oe(e){return ue(e)||ae(e)||se(e)||ie()}function ie(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function se(e,t){if(e){if("string"==typeof e)return ce(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?ce(e,t):void 0}}function ae(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function ue(e){if(Array.isArray(e))return ce(e)}function ce(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function le(){var e,t,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",o=r.toStringTag||"@@toStringTag";function i(r,n,o,i){var u=n&&n.prototype instanceof a?n:a,c=Object.create(u.prototype);return de(c,"_invoke",function(r,n,o){var i,a,u,c=0,l=o||[],d=!1,f={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function t(r,n){return i=r,a=0,u=e,f.n=n,s}};function p(r,n){for(a=r,u=n,t=0;!d&&c&&!o&&t<l.length;t++){var o,i=l[t],p=f.p,v=i[2];r>3?(o=v===n)&&(u=i[(a=i[4])?5:(a=3,3)],i[4]=i[5]=e):i[0]<=p&&((o=r<2&&p<i[1])?(a=0,f.v=n,f.n=i[1]):p<v&&(o=r<3||i[0]>n||n>v)&&(i[4]=r,i[5]=n,f.n=v,a=0))}if(o||r>1)return s;throw d=!0,n}return function(o,l,v){if(c>1)throw TypeError("Generator is already running");for(d&&1===l&&p(l,v),a=l,u=v;(t=a<2?e:u)||!d;){i||(a?a<3?(a>1&&(f.n=-1),p(a,u)):f.n=u:f.v=u);try{if(c=2,i){if(a||(o="next"),t=i[o]){if(!(t=t.call(i,u)))throw TypeError("iterator result is not an object");if(!t.done)return t;u=t.value,a<2&&(a=0)}else 1===a&&(t=i.return)&&t.call(i),a<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),a=1);i=e}else if((t=(d=f.n<0)?u:r.call(n,f))!==s)break}catch(t){i=e,a=1,u=t}finally{c=1}}return{value:t,done:d}}}(r,o,i),!0),c}var s={};function a(){}function u(){}function c(){}t=Object.getPrototypeOf;var l=[][n]?t(t([][n]())):(de(t={},n,function(){return this}),t),d=c.prototype=a.prototype=Object.create(l);function f(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,c):(e.__proto__=c,de(e,o,"GeneratorFunction")),e.prototype=Object.create(d),e}return u.prototype=c,de(d,"constructor",c),de(c,"constructor",u),u.displayName="GeneratorFunction",de(c,o,"GeneratorFunction"),de(d),de(d,o,"Generator"),de(d,n,function(){return this}),de(d,"toString",function(){return"[object Generator]"}),(le=function e(){return{w:i,m:f}})()}function de(e,t,r,n){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}de=function e(t,r,n,i){function s(e,r){de(t,e,function(t){return this._invoke(e,r,t)})}r?o?o(t,r,{value:n,enumerable:!i,configurable:!i,writable:!i}):t[r]=n:(s("next",0),s("throw",1),s("return",2))},de(e,t,r,n)}function fe(e,t,r,n,o,i,s){try{var a=e[i](s),u=a.value}catch(e){return void r(e)}a.done?t(u):Promise.resolve(u).then(n,o)}function pe(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var i=e.apply(t,r);function s(e){fe(i,n,o,s,a,"next",e)}function a(e){fe(i,n,o,s,a,"throw",e)}s(void 0)})}}var ve=function e(){var t;if("undefined"!=typeof process&&{},0,"undefined"!=typeof global){if("window"in global||"document"in global||("undefined"!=typeof process&&{},0),(!("window"in global)||!("document"in global))&&"undefined"!=typeof process&&{},"window"in global&&global.window)return!0;if("document"in global&&global.document)return!0}try{if("undefined"!=typeof window&&null!==window)return("undefined"==typeof global||"window"in global)&&("undefined"!=typeof global&&"undefined"!=typeof process&&{},0,!0);if("undefined"!=typeof document&&null!==document)return("undefined"==typeof global||"document"in global)&&("undefined"!=typeof global&&"undefined"!=typeof process&&{},0,!0)}catch(e){}return"undefined"!=typeof navigator&&"ReactNative"===navigator.product||(!("undefined"==typeof global||!global.__expo)||("undefined"!=typeof location&&null!==location||("undefined"!=typeof process&&{},0,!1)))};function ye(e){var t=[];return!e.authenticationUrl||e.clientId&&e.clientSecret||t.push({type:"warning",code:"INCOMPLETE_AUTH_CONFIG",message:"authenticationUrl provided but clientId/clientSecret incomplete; authenticate() may fail.",field:"authentication"}),t}
/**
 * Validates client-specific configuration and enforces security rules
 * @param {Object} options - SDK options
 * @returns {Array} Array of validation errors (empty if valid)
 */function he(e){var t=[];if(ve()&&e.clientSecret){var r=!1,n=!1,o;try{r=!1}catch(e){}try{n=!1}catch(e){}r||n||t.push({type:"error",code:"CLIENT_SECRET_IN_CLIENT_ENV",message:"clientSecret must not be supplied in a client environment (browser, mobile, Electron renderer). Use options.tokenProvider() to obtain a short-lived token.",field:"clientSecret"})}return t}function me(e){var t=[];return e.websocketUrl&&"string"==typeof e.websocketUrl||t.push({type:"warning",code:"MISSING_WEBSOCKET_URL",message:"websocketUrl not provided; openConnection() will emit an error.",field:"websocketUrl"}),t}function be(e){if(void 0===e.strictValidation){var t="undefined"!=typeof process&&{}?"production":"development";e.strictValidation="production"!==t}if("number"!=typeof e.requestTimeoutMs&&(e.requestTimeoutMs=3e4),"number"!=typeof e.connectionTimeoutMs&&(e.connectionTimeoutMs=1e4),e.logger||(e.logger={debug:function e(){},info:function e(){},warn:function e(){},error:function e(){}}),e.authTransport||(e.authTransport="subprotocol"),void 0===e.authRequired&&(e.authRequired=!0),!e.tokenProvider){var r=e.tokenUrl;if(!r&&"undefined"!=typeof document){var n=document.querySelector('meta[name="optave-token-url"]');n&&n.content&&(r=n.content)}r||(r="/api/optave/ws-ticket"),e.tokenProvider=pe(le().m(function t(){var n,o,i;return le().w(function(t){for(;;)switch(t.n){case 0:return n={},e.publishableKey&&(n["X-Optave-Publishable-Key"]=e.publishableKey),t.n=1,fetch(r,{method:"POST",credentials:"include",headers:n});case 1:if((o=t.v).ok){t.n=2;break}throw new Error("Failed to obtain WS token");case 2:return t.n=3,o.json();case 3:return i=t.v,t.a(2,i.token||i.access_token)}},t)}))}return e}function ge(e){var t={isValid:!0,errors:[],warnings:[]},r=me(e),n=ye(e),o=he(e),i,s=ne([].concat(oe(r),oe(n),oe(o))),a;try{for(s.s();!(a=s.n()).done;){var u=a.value;"error"===u.type?(t.errors.push(u),t.isValid=!1):"warning"===u.type&&t.warnings.push(u)}}catch(e){s.e(e)}finally{s.f()}return t}var Se={BROWSER_ESM:"browser-esm",SERVER_ESM:"server-esm",BROWSER_UMD:"browser-umd",SERVER_UMD:"server-umd"},we={browser:Se.BROWSER_ESM,server:Se.SERVER_ESM},Ee={BROWSER:[Se.BROWSER_ESM,Se.BROWSER_UMD,Se.SERVER_UMD],SERVER:[Se.SERVER_ESM],UMD:[Se.BROWSER_UMD,Se.SERVER_UMD],ESM:[Se.BROWSER_ESM,Se.SERVER_ESM]},_e={isValid:function e(t){return Object.values(Se).includes(t)||Object.keys(we).includes(t)},normalize:function e(t){return we[t]?we[t]:Object.values(Se).includes(t)?t:"unknown"},isBrowser:function e(t){var r=this.normalize(t);return Ee.BROWSER.includes(r)},isServer:function e(t){var r=this.normalize(t);return Ee.SERVER.includes(r)},isUMD:function e(t){var r=this.normalize(t);return Ee.UMD.includes(r)},isESM:function e(t){var r=this.normalize(t);return Ee.ESM.includes(r)},getInfo:function e(t){var r;return{original:t,normalized:this.normalize(t),valid:this.isValid(t),isBrowser:this.isBrowser(t),isServer:this.isServer(t),isUMD:this.isUMD(t),isESM:this.isESM(t)}}};function Oe(e){return Oe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Oe(e)}function ke(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Te(n.key),n)}}function Ie(e,t,r){return t&&ke(e.prototype,t),r&&ke(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function Te(e){var t=Ae(e,"string");return"symbol"==Oe(t)?t:t+""}function Ae(e,t){if("object"!=Oe(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=Oe(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function Re(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function je(e,t,r){return t=Le(t),Pe(e,Me()?Reflect.construct(t,r||[],Le(e).constructor):t.apply(e,r))}function Pe(e,t){if(t&&("object"==Oe(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return qe(e)}function qe(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ce(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&We(e,t)}function Ne(e){var t="function"==typeof Map?new Map:void 0;return Ne=function e(r){if(null===r||!De(r))return r;if("function"!=typeof r)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(r))return t.get(r);t.set(r,n)}function n(){return Ue(r,arguments,Le(this).constructor)}return n.prototype=Object.create(r.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),We(n,r)},Ne(e)}function Ue(e,t,r){if(Me())return Reflect.construct.apply(null,arguments);var n=[null];n.push.apply(n,t);var o=new(e.bind.apply(e,n));return r&&We(o,r.prototype),o}function Me(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(Me=function t(){return!!e})()}function De(e){try{return-1!==Function.toString.call(e).indexOf("[native code]")}catch(t){return"function"==typeof e}}function We(e,t){return We=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},We(e,t)}function Le(e){return Le=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Le(e)}var Ve=function(e){function t(e){var r,n=e.category,o=e.code,i=e.message,s=e.details;return Re(this,t),(r=je(this,t,[i])).name="OptaveError",r.category=n||"UNKNOWN",r.code=o||"UNKNOWN",void 0!==s&&(r.details=s),r}return Ce(t,e),Ie(t)}(Ne(Error));function Be(e){return e&&e.category&&e.code&&e.message?new Ve(e):"string"==typeof e?new Ve({category:"UNKNOWN",code:"STRING_ERROR",message:e}):e&&e.isAuthError?new Ve({category:"AUTHENTICATION",code:e.code||"AUTH_ERROR",message:e.message||"Authentication error",details:e}):e&&e.isWsError?new Ve({category:"WEBSOCKET",code:e.code||"WS_ERROR",message:e.message||"WebSocket error",details:e}):new Ve({category:"UNKNOWN",code:"UNCLASSIFIED",message:e&&e.message||String(null!=e?e:"Unknown error"),details:e})}function Ke(){var e,t,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",o=r.toStringTag||"@@toStringTag";function i(r,n,o,i){var u=n&&n.prototype instanceof a?n:a,c=Object.create(u.prototype);return xe(c,"_invoke",function(r,n,o){var i,a,u,c=0,l=o||[],d=!1,f={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function t(r,n){return i=r,a=0,u=e,f.n=n,s}};function p(r,n){for(a=r,u=n,t=0;!d&&c&&!o&&t<l.length;t++){var o,i=l[t],p=f.p,v=i[2];r>3?(o=v===n)&&(u=i[(a=i[4])?5:(a=3,3)],i[4]=i[5]=e):i[0]<=p&&((o=r<2&&p<i[1])?(a=0,f.v=n,f.n=i[1]):p<v&&(o=r<3||i[0]>n||n>v)&&(i[4]=r,i[5]=n,f.n=v,a=0))}if(o||r>1)return s;throw d=!0,n}return function(o,l,v){if(c>1)throw TypeError("Generator is already running");for(d&&1===l&&p(l,v),a=l,u=v;(t=a<2?e:u)||!d;){i||(a?a<3?(a>1&&(f.n=-1),p(a,u)):f.n=u:f.v=u);try{if(c=2,i){if(a||(o="next"),t=i[o]){if(!(t=t.call(i,u)))throw TypeError("iterator result is not an object");if(!t.done)return t;u=t.value,a<2&&(a=0)}else 1===a&&(t=i.return)&&t.call(i),a<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),a=1);i=e}else if((t=(d=f.n<0)?u:r.call(n,f))!==s)break}catch(t){i=e,a=1,u=t}finally{c=1}}return{value:t,done:d}}}(r,o,i),!0),c}var s={};function a(){}function u(){}function c(){}t=Object.getPrototypeOf;var l=[][n]?t(t([][n]())):(xe(t={},n,function(){return this}),t),d=c.prototype=a.prototype=Object.create(l);function f(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,c):(e.__proto__=c,xe(e,o,"GeneratorFunction")),e.prototype=Object.create(d),e}return u.prototype=c,xe(d,"constructor",c),xe(c,"constructor",u),u.displayName="GeneratorFunction",xe(c,o,"GeneratorFunction"),xe(d),xe(d,o,"Generator"),xe(d,n,function(){return this}),xe(d,"toString",function(){return"[object Generator]"}),(Ke=function e(){return{w:i,m:f}})()}function xe(e,t,r,n){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}xe=function e(t,r,n,i){function s(e,r){xe(t,e,function(t){return this._invoke(e,r,t)})}r?o?o(t,r,{value:n,enumerable:!i,configurable:!i,writable:!i}):t[r]=n:(s("next",0),s("throw",1),s("return",2))},xe(e,t,r,n)}function Ge(e,t,r,n,o,i,s){try{var a=e[i](s),u=a.value}catch(e){return void r(e)}a.done?t(u):Promise.resolve(u).then(n,o)}function Fe(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var i=e.apply(t,r);function s(e){Ge(i,n,o,s,a,"next",e)}function a(e){Ge(i,n,o,s,a,"throw",e)}s(void 0)})}}function ze(){return He.apply(this,arguments)}function He(){return(He=Fe(Ke().m(function e(){return Ke().w(function(e){for(;;)if(0===e.n)return e.a(2,null)},e)}))).apply(this,arguments)}// ./runtime/core/security-guards.js
/**
 * Critical Security Guards for Optave SDK
 *
 * This file contains mandatory security validations that MUST be preserved
 * in all build outputs. Tree-shaking and dead code elimination tools
 * must NOT remove these security checks.
 *
 * SECURITY WARNING: Modifications to this file may introduce security vulnerabilities
 * in Salesforce Lightning environments and other constrained platforms.
 */
/**
 * Runtime WebSocket scheme enforcement for UMD builds
 *
 * This guard prevents insecure WebSocket connections (ws://) in UMD builds,
 * which are specifically deployed in Salesforce Lightning environments where
 * the Locker Service blocks all insecure WebSocket connections.
 *
 * SECURITY: This function has intentional side effects (throws errors) and
 * must be preserved in all build outputs. Removing this validation creates
 * a security vulnerability in production environments.
 *
 * @param {string} websocketUrl - The WebSocket URL to validate
 * @param {string} buildTarget - The webpack build target identifier
 * @param {object} options - SDK configuration options
 * @throws {Error} When ws:// protocol is used in UMD builds
 * @throws {Error} When tokenProvider is missing for secure connections in UMD builds
 */
function Ye(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};
// SECURITY: Explicitly mark as having side effects - do not optimize away
if(1,e&&"string"==typeof e){var n=_e.normalize(t),o=_e.isUMD(n),i=_e.isBrowser(n);
// CRITICAL: Validate WebSocket scheme for UMD and browser builds
// This guard prevents insecure connections in Salesforce Lightning
if((o||i)&&e.startsWith("ws://")){
// SECURITY: This error message must remain intact to guide developers
var s="[Optave SDK] Insecure WebSocket protocol (ws://) is not allowed in UMD builds. Salesforce Lightning Locker Service blocks all ws:// connections for security reasons. Please use secure WebSocket protocol (wss://) instead. "+"Current URL: ".concat(e);
// CRITICAL: This throw statement is a security boundary - must not be removed
throw new Error(s)}
// CRITICAL: For UMD builds with secure WebSocket URLs, validate token provider availability
if(o&&e.startsWith("wss://")){var a="function"==typeof r.tokenProvider,u=!1===r.authRequired;if(!a&&!u){
// SECURITY: This error message must remain intact to guide developers
var c="[Optave SDK] UMD builds require a tokenProvider function for secure WebSocket connections. In constrained environments like Salesforce Lightning, authentication tokens must be obtained from your backend server. Please provide options.tokenProvider() that returns a valid token, or set options.authRequired = false to disable authentication. "+"Current URL: ".concat(e);
// CRITICAL: This throw statement is a security boundary - must not be removed
throw new Error(c)}}}}
/**
 * Initialize security guards on module load
 * This ensures the security validation code is evaluated and cannot be tree-shaken
 */function Je(){var e;
// SECURITY: Module-level side effect to prevent tree-shaking
if("undefined"!=typeof globalThis&&(
// Mark security guards as active - this creates a side effect
globalThis.__OPTAVE_SECURITY_GUARDS_ACTIVE__=!0,!globalThis.__OPTAVE_SECURITY_GUARDS_ACTIVE__))throw new Error("Security guard initialization failed");"undefined"!=typeof process&&{},0}Je(),"undefined"!=typeof window?
// Browser environment - ensure security guards are active
window.__OPTAVE_SECURITY_GUARDS_BROWSER__=!0:"undefined"!=typeof global&&(
// Node.js environment - ensure security guards are active
global.__OPTAVE_SECURITY_GUARDS_NODE__=!0);var Qe=r(746).I;function Xe(e){return et(e)||$e(e)||at(e)||Ze()}function Ze(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function $e(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function et(e){if(Array.isArray(e))return ut(e)}function tt(e){return tt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},tt(e)}function rt(e,t){return it(e)||ot(e,t)||at(e,t)||nt()}function nt(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function ot(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,i,s,a=[],u=!0,c=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=i.call(r)).done)&&(a.push(n.value),a.length!==t);u=!0);}catch(e){c=!0,o=e}finally{try{if(!u&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(c)throw o}}return a}}function it(e){if(Array.isArray(e))return e}function st(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=at(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function e(){};return{s:o,n:function t(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function e(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,a=!1;return{s:function t(){r=r.call(e)},n:function e(){var t=r.next();return s=t.done,t},e:function e(t){a=!0,i=t},f:function e(){try{s||null==r.return||r.return()}finally{if(a)throw i}}}}function at(e,t){if(e){if("string"==typeof e)return ut(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?ut(e,t):void 0}}function ut(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function ct(){var e,t,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",o=r.toStringTag||"@@toStringTag";function i(r,n,o,i){var u=n&&n.prototype instanceof a?n:a,c=Object.create(u.prototype);return lt(c,"_invoke",function(r,n,o){var i,a,u,c=0,l=o||[],d=!1,f={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function t(r,n){return i=r,a=0,u=e,f.n=n,s}};function p(r,n){for(a=r,u=n,t=0;!d&&c&&!o&&t<l.length;t++){var o,i=l[t],p=f.p,v=i[2];r>3?(o=v===n)&&(u=i[(a=i[4])?5:(a=3,3)],i[4]=i[5]=e):i[0]<=p&&((o=r<2&&p<i[1])?(a=0,f.v=n,f.n=i[1]):p<v&&(o=r<3||i[0]>n||n>v)&&(i[4]=r,i[5]=n,f.n=v,a=0))}if(o||r>1)return s;throw d=!0,n}return function(o,l,v){if(c>1)throw TypeError("Generator is already running");for(d&&1===l&&p(l,v),a=l,u=v;(t=a<2?e:u)||!d;){i||(a?a<3?(a>1&&(f.n=-1),p(a,u)):f.n=u:f.v=u);try{if(c=2,i){if(a||(o="next"),t=i[o]){if(!(t=t.call(i,u)))throw TypeError("iterator result is not an object");if(!t.done)return t;u=t.value,a<2&&(a=0)}else 1===a&&(t=i.return)&&t.call(i),a<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),a=1);i=e}else if((t=(d=f.n<0)?u:r.call(n,f))!==s)break}catch(t){i=e,a=1,u=t}finally{c=1}}return{value:t,done:d}}}(r,o,i),!0),c}var s={};function a(){}function u(){}function c(){}t=Object.getPrototypeOf;var l=[][n]?t(t([][n]())):(lt(t={},n,function(){return this}),t),d=c.prototype=a.prototype=Object.create(l);function f(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,c):(e.__proto__=c,lt(e,o,"GeneratorFunction")),e.prototype=Object.create(d),e}return u.prototype=c,lt(d,"constructor",c),lt(c,"constructor",u),u.displayName="GeneratorFunction",lt(c,o,"GeneratorFunction"),lt(d),lt(d,o,"Generator"),lt(d,n,function(){return this}),lt(d,"toString",function(){return"[object Generator]"}),(ct=function e(){return{w:i,m:f}})()}function lt(e,t,r,n){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}lt=function e(t,r,n,i){function s(e,r){lt(t,e,function(t){return this._invoke(e,r,t)})}r?o?o(t,r,{value:n,enumerable:!i,configurable:!i,writable:!i}):t[r]=n:(s("next",0),s("throw",1),s("return",2))},lt(e,t,r,n)}function dt(e,t,r,n,o,i,s){try{var a=e[i](s),u=a.value}catch(e){return void r(e)}a.done?t(u):Promise.resolve(u).then(n,o)}function ft(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var i=e.apply(t,r);function s(e){dt(i,n,o,s,a,"next",e)}function a(e){dt(i,n,o,s,a,"throw",e)}s(void 0)})}}function pt(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function vt(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?pt(Object(r),!0).forEach(function(t){kt(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):pt(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function yt(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ht(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,It(n.key),n)}}function mt(e,t,r){return t&&ht(e.prototype,t),r&&ht(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function bt(e,t,r){return t=Et(t),gt(e,wt()?Reflect.construct(t,r||[],Et(e).constructor):t.apply(e,r))}function gt(e,t){if(t&&("object"==tt(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return St(e)}function St(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function wt(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(wt=function t(){return!!e})()}function Et(e){return Et=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Et(e)}function _t(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Ot(e,t)}function Ot(e,t){return Ot=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Ot(e,t)}function kt(e,t,r){return(t=It(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function It(e){var t=Tt(e,"string");return"symbol"==tt(t)?t:t+""}function Tt(e,t){if("object"!=tt(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=tt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}var At="3.2.1",Rt=function e(){var t="browser-umd";return{isBrowser:_e.isBrowser(t),isServer:_e.isServer(t),buildTarget:t}},jt=function e(){var t=Rt();return"unknown"!==t.buildTarget?t.isBrowser:"undefined"!=typeof window&&void 0!==window.WebSocket},Pt=!1,qt=!1,OptaveJavaScriptSDK=function(e){function OptaveJavaScriptSDK(e){var t,r;if(yt(this,OptaveJavaScriptSDK),kt(r=bt(this,OptaveJavaScriptSDK),"options",{}),kt(r,"wss",null),r.options=vt({},e),be(r.options),void 0===r.options.cspSafe){var n=Rt();"server-esm"===n.buildTarget||"server"===n.buildTarget?r.options.cspSafe=!1:("server-umd"===n.buildTarget||"browser-esm"===n.buildTarget||"browser-umd"===n.buildTarget||n.isBrowser||jt())&&(r.options.cspSafe=!0)}var o=ge(r.options);if(!o.isValid){var i=o.errors.map(function(e){return e.message}).join("; ");throw new Error("[Optave SDK] Configuration errors: ".concat(i))}o.warnings.forEach(function(e){var t;((null===(t=r.options)||void 0===t||null===(t=t.logger)||void 0===t?void 0:t.warn)||console.warn)("[Optave SDK] ".concat(e.message))});
// SECURITY: This validation is critical for Salesforce Lightning security - must not be removed by tree-shaking
var s="browser-umd";try{
// Use canonical security guard - single source of truth for WebSocket validation
Ye(r.options.websocketUrl,s,r.options)}catch(e){
// Re-throw security errors immediately - this prevents minification from removing the try/catch
throw e}var a=Rt();return r.WebSocketImpl=r.options.WebSocketImpl,!r.WebSocketImpl&&a.isBrowser?r.WebSocketImpl=("undefined"!=typeof WebSocket?WebSocket:void 0)||("undefined"!=typeof window&&window.WebSocket?window.WebSocket:void 0):!r.WebSocketImpl&&a.isServer&&(r.WebSocketImpl="undefined"!=typeof WebSocket?WebSocket:void 0),r._pending=new Map,r._deprecatedKeys=new Set,r._silenceDeprecations="undefined"!=typeof process&&"1"===(null===(t=process)||void 0===t||null===(t={})||void 0===t?void 0:t.OPTAVE_SDK_SILENCE_DEPRECATIONS),r.options.cspSafe,r._validatePayload=B,r._validateMessageEnvelope=K,r}return _t(OptaveJavaScriptSDK,e),mt(OptaveJavaScriptSDK,[{key:"_ensureWebSocketImpl",value:function(){var e=ft(ct().m(function e(){var t;return ct().w(function(e){for(;;)switch(e.n){case 0:if(!this.WebSocketImpl){e.n=1;break}return e.a(2,this.WebSocketImpl);case 1:if(t=Rt(),this.WebSocketImpl=this.options.WebSocketImpl,!this.WebSocketImpl&&t.isBrowser?this.WebSocketImpl=("undefined"!=typeof WebSocket?WebSocket:void 0)||("undefined"!=typeof window&&window.WebSocket?window.WebSocket:void 0):!this.WebSocketImpl&&t.isServer&&(this.WebSocketImpl="undefined"!=typeof WebSocket?WebSocket:void 0),this.WebSocketImpl){e.n=4;break}if(!t.isBrowser){e.n=2;break}this.WebSocketImpl="undefined"!=typeof WebSocket?WebSocket:null,e.n=4;break;case 2:if(!t.isServer){e.n=4;break}return e.n=3,this.loadNodeWebSocket();case 3:this.WebSocketImpl=e.v;case 4:return e.a(2,this.WebSocketImpl)}},e,this)}));function t(){return e.apply(this,arguments)}return t}()},{key:"loadNodeWebSocket",value:function(){var e=ft(ct().m(function e(){var t;return ct().w(function(e){for(;;)switch(e.n){case 0:if(!(t=Rt()).isBrowser){e.n=1;break}return e.a(2,null);case 1:if("unknown"!==t.buildTarget||"undefined"==typeof window&&"undefined"==typeof document&&"undefined"==typeof navigator&&"undefined"==typeof location){e.n=2;break}return e.a(2,null);case 2:return"undefined"==typeof process||!{},0,e.a(2,null);case 3:return e.n=4,ze();case 4:return e.a(2,e.v)}},e)}));function t(){return e.apply(this,arguments)}return t}()},{key:"setSessionId",value:function e(t){return this.sessionId=t,this}},{key:"getSessionId",value:function e(){return this.sessionId||""}},{key:"validate",value:function e(t){var r;return this._validatePayload(t).valid}},{key:"validateEnvelope",value:function e(t){var r;return this._validateMessageEnvelope(t).valid}},{key:"validateRequiredFields",value:function e(t,r){var n,o,i,s,a,u,c,l,d,f,p,v,y=[];switch(null!==(n=t.request)&&void 0!==n&&null!==(n=n.connections)&&void 0!==n&&n.threadId||y.push("request.connections.threadId is required"),r){case"adjust":null!==(o=t.request)&&void 0!==o&&null!==(o=o.attributes)&&void 0!==o&&o.content||y.push("request.attributes.content is required for adjust"),null!==(i=t.request)&&void 0!==i&&null!==(i=i.attributes)&&void 0!==i&&i.instruction||y.push("request.attributes.instruction is required for adjust"),null!==(s=t.request)&&void 0!==s&&null!==(s=s.connections)&&void 0!==s&&s.parentId||y.push("request.connections.parentId is required for adjust"),null!==(a=t.request)&&void 0!==a&&null!==(a=a.scope)&&void 0!==a&&a.conversations&&Array.isArray(t.request.scope.conversations)&&0!==t.request.scope.conversations.length||y.push("request.scope.conversations is required for adjust and must be a non-empty array");break;case"elevate":null!==(u=t.request)&&void 0!==u&&null!==(u=u.attributes)&&void 0!==u&&u.content||y.push("request.attributes.content is required for elevate"),null!==(c=t.request)&&void 0!==c&&null!==(c=c.connections)&&void 0!==c&&c.parentId||y.push("request.connections.parentId is required for elevate"),null!==(l=t.request)&&void 0!==l&&null!==(l=l.scope)&&void 0!==l&&l.conversations&&Array.isArray(t.request.scope.conversations)&&0!==t.request.scope.conversations.length||y.push("request.scope.conversations is required for elevate and must be a non-empty array");break;case"translate":case"summarize":case"insights":null!==(d=t.request)&&void 0!==d&&null!==(d=d.scope)&&void 0!==d&&d.conversations&&Array.isArray(t.request.scope.conversations)&&0!==t.request.scope.conversations.length||y.push("request.scope.conversations is required for ".concat(r," and must be a non-empty array"));break;case"recommend":null!==(f=t.request)&&void 0!==f&&null!==(f=f.resources)&&void 0!==f&&f.offers&&Array.isArray(t.request.resources.offers)&&0!==t.request.resources.offers.length||y.push("request.resources.offers is required for recommend and must be a non-empty array"),null!==(p=t.request)&&void 0!==p&&null!==(p=p.scope)&&void 0!==p&&p.conversations&&Array.isArray(t.request.scope.conversations)&&0!==t.request.scope.conversations.length||y.push("request.scope.conversations is required for recommend and must be a non-empty array");break;case"customerinteraction":case"customerInteraction":case"interaction":null!==(v=t.request)&&void 0!==v&&null!==(v=v.scope)&&void 0!==v&&v.conversations&&Array.isArray(t.request.scope.conversations)&&0!==t.request.scope.conversations.length||y.push("request.scope.conversations is required for ".concat(r," and must be a non-empty array"))}return{isValid:0===y.length,errors:y}}},{key:"authenticate",value:function(){var e=ft(ct().m(function e(){var t,r,n,o,i,s,a,u;return ct().w(function(e){for(;;)switch(e.n){case 0:if(
// Browser-targeted builds should not use client credentials for security
t="browser-umd",!(r=_e.isBrowser(t))){e.n=1;break}return this.handleError(H.AUTHENTICATION,"UNSUPPORTED_IN_BROWSER","authenticate() is not available in browsers. Use options.tokenProvider() to obtain a short-lived WebSocket token from your backend."),e.a(2,null);case 1:if(n={grant_type:"client_credentials"},this.options.authenticationUrl){e.n=2;break}return this.handleError(H.AUTHENTICATION,"INVALID_AUTHENTICATION_URL","Empty or invalid authentication URL"),e.a(2,null);case 2:if(this.options.clientId){e.n=3;break}return this.handleError(H.AUTHENTICATION,"INVALID_CLIENT_ID","Empty or invalid client ID"),e.a(2,null);case 3:return n.client_id=this.options.clientId,n.client_secret=this.options.clientSecret,o=new Qe(n).toString(),(i=this.options.authenticationUrl).endsWith("/token")||(i=i.endsWith("/")?i+"token":i+"/token"),s="".concat(i,"?").concat(o),e.n=4,fetch(s,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"}});case 4:return a=e.v,e.n=5,a.json();case 5:if(u=e.v,a.ok){e.n=6;break}return this.handleError(H.AUTHENTICATION,"INVALID_AUTHENTICATION_RESPONSE",this.formatAuthenticationError(a,u.error,"token endpoint").message,u.error),e.a(2,null);case 6:return e.a(2,u.access_token)}},e,this)}));function t(){return e.apply(this,arguments)}return t}()},{key:"openConnection",value:function(){var e=ft(ct().m(function e(t){var r=this,n,o,i,s,a,u,c,l;return ct().w(function(e){for(;;)switch(e.p=e.n){case 0:if(this.options.websocketUrl){e.n=1;break}return((null===(n=this.options)||void 0===n||null===(n=n.logger)||void 0===n?void 0:n.error)||console.error)("[Optave SDK] openConnection aborted: missing websocketUrl"),this.handleError(H.WEBSOCKET,"INVALID_WEBSOCKET_URL",this.formatWebSocketError(new Error("Invalid WebSocket URL configuration"),{url:this.options.websocketUrl}).message,this.options.websocketUrl),e.a(2);case 1:return o=function(){var e=ft(ct().m(function e(){var n;return ct().w(function(e){for(;;)switch(e.p=e.n){case 0:if(!("string"==typeof t&&t.length>0)){e.n=1;break}return e.a(2,t);case 1:if("function"!=typeof r.options.tokenProvider){e.n=5;break}return e.p=2,e.n=3,r.options.tokenProvider();case 3:return e.a(2,e.v);case 4:return e.p=4,n=e.v,r.handleError(H.AUTHENTICATION,"TOKEN_PROVIDER_FAILED",r.formatTokenProviderError(n).message,n),e.a(2,null);case 5:return e.a(2,null)}},e,null,[[2,4]])}));return function t(){return e.apply(this,arguments)}}(),e.n=2,o();case 2:return i=e.v,e.n=3,this._ensureWebSocketImpl();case 3:if(this.WebSocketImpl){e.n=4;break}return this.handleError(H.WEBSOCKET,"NO_WEBSOCKET_IMPL",this.formatWebSocketError(new Error("No WebSocket implementation available"),{environment:"undefined"!=typeof window?"browser":"node"}).message),e.a(2);case 4:if(i||!1===this.options.authRequired){e.n=5;break}return this.handleError(H.AUTHENTICATION,"MISSING_TOKEN","No WebSocket token available. Provide options.tokenProvider() or set options.tokenUrl."),e.a(2);case 5:s=new Qe,this.sessionId&&s.set("OptaveTraceChatSessionId",this.sessionId),e.p=6,"subprotocol"===this.options.authTransport?(a=i?["optave-v1",i]:["optave-v1"],this.wss=new this.WebSocketImpl(s.toString()?"".concat(this.options.websocketUrl,"?").concat(s.toString()):this.options.websocketUrl,a)):(i&&(u=i.replace(/^Bearer\s+/i,""),s.set("Authorization",u)),this.wss=new this.WebSocketImpl(s.toString()?"".concat(this.options.websocketUrl,"?").concat(s.toString()):this.options.websocketUrl),i&&this._warnOnce("_warnedQueryToken",'[Optave SDK] Passing auth token in WebSocket URL query is discouraged. Prefer authTransport="subprotocol".')),e.n=8;break;case 7:return e.p=7,l=e.v,((null===(c=this.options)||void 0===c||null===(c=c.logger)||void 0===c?void 0:c.error)||console.error)("[Optave SDK] WebSocket constructor threw",l),this.handleError(H.WEBSOCKET,"WEBSOCKET_ERROR",this.formatWebSocketError(l,{url:this.options.websocketUrl}).message,l),e.a(2);case 8:return e.a(2,new Promise(function(e,t){var n=setTimeout(function(){var e=r.options.connectionTimeoutMs||3e4,n=r.formatWebSocketError(new Error("Connection timeout"),{timeout:e,url:r.options.websocketUrl}).message;r.handleError(H.WEBSOCKET,"CONNECTION_TIMEOUT",n),t({category:H.WEBSOCKET,code:"CONNECTION_TIMEOUT",message:n,details:null})},r.options.connectionTimeoutMs||3e4);r.wss.onopen=function(t){clearTimeout(n),r.emit("open",t),e(t)},r.wss.onmessage=function(e){r._handleInbound(e.data)},r.wss.onclose=function(e){clearTimeout(n),r.emit("close",e);
// CRITICAL: Race condition prevention for promise handling
var t=st(r._pending.entries()),o;try{for(t.s();!(o=t.n()).done;){var i=rt(o.value,2),s=i[0],a=i[1];a.timer&&clearTimeout(a.timer),a._handled=!0,a.reject({category:H.WEBSOCKET,code:"CONNECTION_CLOSED",message:"WebSocket connection closed: ".concat(e.reason||"Connection lost"),details:{code:e.code,reason:e.reason,correlationId:s},correlationId:s})}}catch(e){t.e(e)}finally{t.f()}r._pending.clear(),r.wss=null},r.wss.onerror=function(e){clearTimeout(n);
// CRITICAL: Enhanced error message handling and race condition prevention
var o=e.message||(e instanceof Error?e.message:null)||"object"===tt(e)&&e.error&&e.error.message||"WebSocket connection failed",i={category:H.WEBSOCKET,code:"CONNECTION_ERROR",message:o,details:{originalError:e}},s=st(r._pending.entries()),a;try{for(s.s();!(a=s.n()).done;){var u=rt(a.value,2),c=u[0],l=u[1];l.timer&&clearTimeout(l.timer),l._handled=!0,l.reject(vt(vt({},i),{},{details:vt(vt({},i.details),{},{correlationId:c}),correlationId:c}))}}catch(e){s.e(e)}finally{s.f()}r._pending.clear(),r.emit("error",i),t(i)}}))}},e,this,[[6,7]])}));function t(t){return e.apply(this,arguments)}return t}()},{key:"_warnOnce",value:function e(t,r){var n;this[t]||(this[t]=!0,((null===(n=this.options)||void 0===n||null===(n=n.logger)||void 0===n?void 0:n.warn)||console.warn)(r))}},{key:"deprecate",value:function e(t,r){var n;this._silenceDeprecations||this._deprecatedKeys.has(t)||(this._deprecatedKeys.add(t),((null===(n=this.options)||void 0===n||null===(n=n.logger)||void 0===n?void 0:n.warn)||console.warn)(r))}},{key:"_handleInbound",value:function e(t){var r,n,o,i,s,a,u;try{u="string"==typeof t?JSON.parse(t):t}catch(e){var c={category:H.WEBSOCKET,code:"INVALID_JSON",message:"Invalid JSON received from server",details:e,timestamp:(new Date).toISOString()};return this._emitError(c),void 0}var l=u&&u.headers&&u.payload,d="error"===(null===(r=u)||void 0===r?void 0:r.state)||"error"===(null===(n=u)||void 0===n?void 0:n.actionType)||!(null===(o=u)||void 0===o||!o.error);if(this.options.strictValidation&&l){var f=this._validateMessageEnvelope(u);f.valid||this.handleError(H.VALIDATION,"INBOUND_ENVELOPE_SCHEMA_MISMATCH",this.formatValidationErrorMessage(f.errors,"Inbound envelope validation failed"),f.errors)}if(d){var p,v,y,h,m,b,g,S=(null===(p=u)||void 0===p?void 0:p.headers)&&u.headers.correlationId||(null===(v=u)||void 0===v?void 0:v.correlationId)||null,w={category:H.ORCHESTRATOR,code:(null===(y=u)||void 0===y||null===(y=y.error)||void 0===y?void 0:y.code)||"REMOTE_ERROR",message:(null===(h=u)||void 0===h||null===(h=h.error)||void 0===h?void 0:h.message)||(null===(m=u)||void 0===m?void 0:m.message)||"Remote error",details:(null===(b=u)||void 0===b?void 0:b.error)||u,correlationId:S};if(S&&this._pending.has(S)){var E=this._pending.get(S);E.timer&&clearTimeout(E.timer),E._handled=!0,this._pending.delete(S),E.reject(w)}return this._emitError(w,null===(g=u)||void 0===g?void 0:g.action),void 0}var _=(null===(i=u)||void 0===i||null===(i=i.headers)||void 0===i?void 0:i.correlationId)||(null===(s=u)||void 0===s?void 0:s.correlationId),O;if(_&&this._pending.has(_)){var k=this._pending.get(_);k.timer&&clearTimeout(k.timer),k._handled=!0,this._pending.delete(_),k.resolve(u)}(this.emit(Y.MESSAGE,u),Pt)||(Pt=!0,((null===(O=this.options)||void 0===O||null===(O=O.logger)||void 0===O?void 0:O.warn)||console.warn)('[optave-sdk][deprecation] The "message" event will be deprecated. Please also listen to "superpower.response".'));this.emit(Q.SUPERPOWER_RESPONSE,u),this.emit(J.RESPONSE,u),null!==(a=u)&&void 0!==a&&a.action&&this.emit("message.".concat(u.action).toLowerCase(),u),l&&u.headers.schemaRef&&this.emit(u.headers.schemaRef,u)}},{key:"_emitError",value:function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n;(t.timestamp||(t.timestamp=(new Date).toISOString()),this.emit(Y.ERROR,t),qt)||(qt=!0,((null===(n=this.options)||void 0===n||null===(n=n.logger)||void 0===n?void 0:n.warn)||console.warn)('[optave-sdk][deprecation] The "error" (string payload) is deprecated. Please also listen to "superpower.error" for a structured error object.'));var o=Be(t);this.emit(Q.SUPERPOWER_ERROR,o),this.emit(J.ERROR,t)}},{key:"closeConnection",value:function e(){this.wss&&(this.wss.onopen=null,this.wss.onmessage=null,this.wss.onclose=null,this.wss.onerror=null,this.wss.close(),this.wss=null)}},{key:"selectiveDeepMerge",value:function e(t,r){if(Array.isArray(t)&&Array.isArray(r))return Xe(r);var n=function e(t){return null!==t&&"object"===tt(t)&&!Array.isArray(t)};if(n(t)&&n(r)){var o=vt({},t);for(var i in r)o[i]=i in t?this.selectiveDeepMerge(t[i],r[i]):r[i];return o}return void 0!==r?r:t}},{key:"isPayloadSizeValid",value:function e(t){return!!t&&t.length/1024<=re.MAX_PAYLOAD_SIZE_KB}},{key:"openConnectionAsync",value:function e(t){var r=this;return new Promise(function(e,n){var o=function t(n){r.off("error",i),e(n)},i=function e(t){r.off("open",o),n(t)};r.once("open",o),r.once("error",i),r.openConnection(t)})}},{key:"buildPayload",value:function e(t,r,n){var o,i,s,a=this.selectiveDeepMerge(OptaveJavaScriptSDK.defaultPayload,n);return null!=n&&null!==(o=n.request)&&void 0!==o&&o.variation&&(this.deprecate("payload.request.variation","[Deprecation] 'request.variation' is deprecated; use 'request.attributes.variant'."),a.request.attributes.variant=n.request.variation),null==n||null===(i=n.request)||void 0===i||!i.content||null!==(s=a.request)&&void 0!==s&&null!==(s=s.attributes)&&void 0!==s&&s.content||(a.request.attributes.content=n.request.content,this.deprecate("payload.request.content","[Deprecation] 'request.content' is deprecated; use 'request.attributes.content'.")),a.request.attributes.variant&&(a.request.attributes.variant=a.request.attributes.variant.toUpperCase()),a}},{key:"resolveMessageId",value:function e(t,r){return"".concat(r,".").concat(t,".v3").toLowerCase()}},{key:"buildMessageEnvelope",value:function e(t,r,n){var o,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},s=(new Date).toISOString(),a=i.correlationId||(null==t||null===(o=t.request)||void 0===o?void 0:o.requestId)||W(),u=i.traceId||W(),c=i.idempotencyKey||W(),l=i.timestamp,d,f={correlationId:a,action:n,schemaRef:z,sdkVersion:At,identifier:r,traceId:u,idempotencyKey:c,timestamp:l,issuedAt:s};return this.options.tenantId&&(f.tenantId=this.options.tenantId),void 0!==i.networkLatencyMs&&(f.networkLatencyMs=i.networkLatencyMs),Object.freeze(f),{action:"message",headers:f,payload:t}}},{key:"formatValidationErrorMessage",value:function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Validation failed";if(!t||!Array.isArray(t)||0===t.length)return r;if(1===t.length){var n=t[0],o=n.instancePath||"/",i="/"===o?"root object":o.replace(/^\//,"").replace(/\//g,".");if("required"===n.keyword){var s,a=(null===(s=n.params)||void 0===s?void 0:s.missingProperty)||"unknown field",u="root object"===i?a:i.endsWith(a)?i:i+"."+a;return"".concat(r,": ").concat("root object"===i?"Required field":"Field"," '").concat(u,"' is missing")}if("type"===n.keyword){var c,l=(null===(c=n.params)||void 0===c?void 0:c.type)||"unknown";return"".concat(r,": Field '").concat(i,"' must be of type '").concat(l,"'")}if("additionalProperties"===n.keyword){var d,f=(null===(d=n.params)||void 0===d?void 0:d.additionalProperty)||"unknown";return"".concat(r,": Field '").concat(i,".").concat(f,"' is not allowed")}if("enum"===n.keyword){var p,v=(null===(p=n.params)||void 0===p?void 0:p.allowedValues)||[],y=Array.isArray(v)?v.join(", "):"unknown values";return"".concat(r,": Field '").concat(i,"' must be one of: ").concat(y)}return"".concat(r,": ").concat(n.message," at '").concat(i,"'")}
// If there are multiple errors, provide a summary with the most critical ones
var h=t.filter(function(e){return"required"===e.keyword}),m=t.filter(function(e){return"type"===e.keyword}),b=t.filter(function(e){return"required"!==e.keyword&&"type"!==e.keyword}),g=r+":";if(h.length>0){var S=h.map(function(e){var t,r=(e.instancePath||"/").replace(/^\//,"").replace(/\//g,"."),n=(null===(t=e.params)||void 0===t?void 0:t.missingProperty)||"unknown";return""===r?n:"".concat(r,".").concat(n)});g+=" Missing required fields: ".concat(S.join(", "),".")}if(m.length>0){var w=m.slice(0,3).map(function(e){var t,r=(e.instancePath||"/").replace(/^\//,"").replace(/\//g,"."),n=(null===(t=e.params)||void 0===t?void 0:t.type)||"unknown";return"".concat(r||"root"," (expected ").concat(n,")")});g+=" Type errors in: ".concat(w.join(", "),"."),m.length>3&&(g+=" And ".concat(m.length-3," more type errors."))}return b.length>0&&(g+=" Additional validation errors: ".concat(b.length,".")),g}},{key:"formatAuthenticationError",value:function e(t,r,n){var o="Authentication failed",i=[];return t&&t.status&&(o+=" (HTTP ".concat(t.status,")")),r&&("string"==typeof r?o+=": ".concat(r):r.error_description?o+=": ".concat(r.error_description):r.message?o+=": ".concat(r.message):r.error&&(o+=": ".concat(r.error))),t&&401===t.status?(i.push("Verify clientId and clientSecret are correct"),i.push("Ensure credentials match the target environment (dev/staging/production)")):t&&403===t.status?(i.push("Check if your client has the necessary permissions"),i.push("Verify the authentication endpoint URL is correct")):t&&t.status>=500?(i.push("Authentication server error - try again later"),i.push("Contact support if the problem persists")):i.push("Check network connectivity and authentication endpoint configuration"),n&&n.authUrl&&(o+=" (endpoint: ".concat(n.authUrl,")")),{message:o,suggestions:i}}},{key:"formatWebSocketError",value:function e(t,r){var n="WebSocket connection failed",o=[],i=(null==t?void 0:t.message)||(t instanceof Error?t.message:null)||"object"===tt(t)&&t.error&&t.error.message||null;return i&&(n+=": ".concat(i)),r&&(r.url&&(n+=" (URL: ".concat(r.url,")")),r.timeout&&(n+=" (timeout: ".concat(r.timeout,"ms)"))),o.push("Check network connectivity and firewall settings"),o.push("Verify WebSocket URL is correct and accessible"),r&&r.url&&(r.url.startsWith("ws://")&&o.push("Consider using secure WebSocket (wss://) for production"),(r.url.includes("localhost")||r.url.includes("127.0.0.1"))&&o.push("Ensure local server is running if connecting to localhost")),r&&r.timeout&&o.push("Try increasing connection timeout if network is slow"),{message:n,suggestions:o}}},{key:"formatPayloadSizeError",value:function e(t,r,n){var o=Math.ceil(t/1024),i=r,s=o-i,a="Payload too large: ".concat(o,"KB exceeds maximum ").concat(i,"KB (").concat(s,"KB over limit)"),u=[];if(n&&"object"===tt(n)){var c,l,d,f=JSON.stringify(n);if(null!==(c=n.request)&&void 0!==c&&null!==(c=c.scope)&&void 0!==c&&c.conversations&&Array.isArray(n.request.scope.conversations)){var p=JSON.stringify(n.request.scope.conversations).length,v=Math.ceil(p/1024);v>10&&(u.push("Consider reducing conversation history - current size: ~".concat(v,"KB")),u.push("Remove older messages or summarize conversation context"))}if(null!==(l=n.request)&&void 0!==l&&null!==(l=l.resources)&&void 0!==l&&l.offers&&Array.isArray(n.request.resources.offers)){var y=JSON.stringify(n.request.resources.offers).length,h=Math.ceil(y/1024);h>5&&u.push("Consider reducing product offers data - current size: ~".concat(h,"KB"))}if(null!==(d=n.session)&&void 0!==d&&null!==(d=d.channel)&&void 0!==d&&d.metadata&&Array.isArray(n.session.channel.metadata)){var m=JSON.stringify(n.session.channel.metadata).length,b=Math.ceil(m/1024);b>2&&u.push("Consider reducing metadata array - current size: ~".concat(b,"KB"))}}return 0===u.length&&(u.push("Remove unused fields from request payload"),u.push("Consider paginating large datasets"),u.push("Use shorter field values where possible")),{message:a,suggestions:u}}},{key:"formatTokenProviderError",value:function e(t,r){var n="Failed to obtain WebSocket token from tokenProvider()",o=[],i,s,a,u,c,l;t&&(t.message?n+=": ".concat(t.message):"string"==typeof t&&(n+=": ".concat(t)),"TypeError"===t.name&&null!==(i=t.message)&&void 0!==i&&i.includes("fetch")?(o.push("Check if tokenProvider endpoint is accessible"),o.push("Verify CORS settings allow requests to token endpoint")):null!==(s=t.message)&&void 0!==s&&s.includes("404")||null!==(a=t.message)&&void 0!==a&&a.includes("Not Found")?(o.push("Verify tokenProvider endpoint URL is correct"),o.push("Ensure backend token endpoint is implemented")):null!==(u=t.message)&&void 0!==u&&u.includes("401")||null!==(c=t.message)&&void 0!==c&&c.includes("403")?(o.push("Check authentication/authorization for token endpoint"),o.push("Verify user session or credentials are valid")):null!==(l=t.message)&&void 0!==l&&l.includes("timeout")&&o.push("Token provider request timed out - check network or server response time"));return r&&r.tokenUrl&&(n+=" (endpoint: ".concat(r.tokenUrl,")")),0===o.length&&(o.push("Verify tokenProvider function implementation"),o.push("Check backend token endpoint is running and accessible"),o.push("Review browser console for network errors")),{message:n,suggestions:o}}},{key:"handleError",value:function e(t,r,n){var o,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,a=new Ve({category:t,code:r,message:n,details:arguments.length>3&&void 0!==arguments[3]?arguments[3]:null}),u;(i&&(a.suggestions=i),s&&(a.correlationId=s),0===this.listenerCount(Y.ERROR)&&0===this.listenerCount(J.ERROR))&&((null===(u=this.options)||void 0===u||null===(u=u.logger)||void 0===u?void 0:u.error)||console.error)("[Optave SDK] ".concat(r,": ").concat(n));this._emitError(a)}},{key:"send",value:function e(t,r,n){var o=null!=(this.WebSocketImpl&&this.WebSocketImpl.OPEN)?this.WebSocketImpl.OPEN:1;if(!this.wss||this.wss.readyState!==o){var i=this.wss?this.wss.readyState:"no connection";return this.handleError(H.WEBSOCKET,"WEBSOCKET_NOT_IN_OPEN_STATE",this.formatWebSocketError(new Error("WebSocket not ready for sending"),{readyState:i,action:r}).message),void 0}if(!X.has(r))return this.handleError(H.VALIDATION,"INVALID_ACTION","Unsupported action '".concat(r,"'. Allowed: ").concat(Xe(X).join(", "))),void 0;for(var s=new Set(["session","request","headers"]),a=0,u=Object.keys(n||{});a<u.length;a++){var c=u[a];if(!s.has(c)){var l=[{instancePath:"",keyword:"additionalProperties",params:{additionalProperty:c},message:"must NOT have additional property '".concat(c,"'")}];return this.handleError(H.VALIDATION,"PAYLOAD_SCHEMA_MISMATCH",this.formatValidationErrorMessage(l),l),void 0}}var d=this.buildPayload(t,r,n||{}),f=this.validateRequiredFields(d||{},r);if(!f.isValid)return this.handleError(H.VALIDATION,"REQUIRED_FIELDS_MISSING","Missing required fields for action '".concat(r,"': ").concat(f.errors.join(", ")),f.errors),void 0;if(this.options.strictValidation){var p=this._validatePayload(d);if(!p.valid)return this.handleError(H.VALIDATION,"PAYLOAD_SCHEMA_MISMATCH",this.formatValidationErrorMessage(p.errors,"Schema validation failed"),p.errors),void 0}var v=this.buildMessageEnvelope(d,t,r,(null==n?void 0:n.headers)||{}),y=JSON.stringify(v);if(!this.isPayloadSizeValid(y)){var h=y.length;return this.handleError(H.VALIDATION,"PAYLOAD_TOO_LARGE",this.formatPayloadSizeError(h,re.MAX_PAYLOAD_SIZE_KB,v).message,re.MAX_PAYLOAD_SIZE_KB),void 0}this.wss.send(y)}},{key:"adjust",value:function e(t){return this.send("message","adjust",t)}},{key:"elevate",value:function e(t){return this.send("message","elevate",t)}},{key:"interaction",value:function e(t){return this.send("message","interaction",t)}},{key:"reception",value:function e(t){return this.send("message","reception",t)}},{key:"customerInteraction",value:function e(t){return this.deprecate("method.customerInteraction","[Deprecation] 'customerInteraction' is deprecated; use 'interaction' instead."),this.send("message","customerInteraction",t)}},{key:"summarize",value:function e(t){return this.send("message","summarize",t)}},{key:"translate",value:function e(t){return this.send("message","translate",t)}},{key:"recommend",value:function e(t){return this.send("message","recommend",t)}},{key:"insights",value:function e(t){return this.send("message","insights",t)}},{key:"_registerPending",value:function e(t,r,n,o,i){var s=this,a=null;n>0&&(a=setTimeout(function(){if(s._pending.has(t)){var e=s._pending.get(t);e&&!e._handled&&(s._pending.delete(t),e._handled=!0,i({category:H.WEBSOCKET,code:"REQUEST_TIMEOUT",message:"Request timed out after ".concat(n,"ms"),details:{correlationId:t,action:r},correlationId:t}))}},n)),this._pending.set(t,{resolve:o,reject:i,timer:a,action:r,_handled:!1})}},{key:"_promiseSend",value:function e(t,r){var n=this,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},s,a,u,c=new Promise(function(e,c){a=e,u=c;var l="number"==typeof i.timeoutMs?i.timeoutMs:"number"==typeof i.timeout?i.timeout:n.options.requestTimeoutMs;if(!n.wss||n.wss.readyState!==WebSocket.OPEN){if(l<=0)return c({category:H.WEBSOCKET,code:"WEBSOCKET_NOT_IN_OPEN_STATE",message:"WebSocket not open",details:null}),void 0;var d=n.buildPayload(t,r,o),f=n.buildMessageEnvelope(d,t,r,(null==o?void 0:o.headers)||{});return s=f.headers.correlationId,n._registerPending(s,r,l,e,c),void 0}if(!X.has(r))return c({category:H.VALIDATION,code:"INVALID_ACTION",message:"Unsupported action '".concat(r,"'."),details:{allowed:Xe(X)}}),void 0;for(var p=new Set(["session","request","headers"]),v=0,y=Object.keys(o||{});v<y.length;v++){var h=y[v];if(!p.has(h)){var m=[{instancePath:"",keyword:"additionalProperties",params:{additionalProperty:h},message:"must NOT have additional property '".concat(h,"'")}];return c({category:H.VALIDATION,code:"PAYLOAD_SCHEMA_MISMATCH",message:n.formatValidationErrorMessage(m),details:m}),void 0}}var b=n.buildPayload(t,r,o),g=n.validateRequiredFields(b,r);if(!g.isValid)return c({category:H.VALIDATION,code:"REQUIRED_FIELDS_MISSING",message:"Missing required fields for action '".concat(r,"'"),details:g.errors}),void 0;if(n.options.strictValidation){var S=B(b);if(!S.valid)return c({category:H.VALIDATION,code:"PAYLOAD_SCHEMA_MISMATCH",message:n.formatValidationErrorMessage(S.errors,"Schema validation failed"),details:S.errors}),void 0}var w=n.buildMessageEnvelope(b,t,r,(null==o?void 0:o.headers)||{});s=w.headers.correlationId,n._registerPending(s,r,l,e,c);var E=JSON.stringify(w);if(!n.isPayloadSizeValid(E)){var _=E.length,O=n.formatPayloadSizeError(_,re.MAX_PAYLOAD_SIZE_KB,w).message;return c({category:H.VALIDATION,code:"PAYLOAD_TOO_LARGE",message:O,details:{maxKb:re.MAX_PAYLOAD_SIZE_KB}}),void 0}try{n.wss.send(E)}catch(e){if(n._pending.has(s)){var k=n._pending.get(s);k.timer&&clearTimeout(k.timer),k._handled=!0,n._pending.delete(s)}c({category:H.WEBSOCKET,code:"SEND_FAILED",message:"Failed to send over WebSocket",details:e,correlationId:s})}});return c.correlationId=s,c}},{key:"adjustAsync",value:function e(t,r){return this._promiseSend("message","adjust",t,r)}},{key:"elevateAsync",value:function e(t,r){return this._promiseSend("message","elevate",t,r)}},{key:"interactionAsync",value:function e(t,r){return this._promiseSend("message","interaction",t,r)}},{key:"receptionAsync",value:function e(t,r){return this._promiseSend("message","reception",t,r)}},{key:"customerInteractionAsync",value:function e(t,r){return this.deprecate("method.customerInteractionAsync","[Deprecation] 'customerInteractionAsync' is deprecated; use 'interactionAsync' instead."),this._promiseSend("message","customerInteraction",t,r)}},{key:"summarizeAsync",value:function e(t,r){return this._promiseSend("message","summarize",t,r)}},{key:"translateAsync",value:function e(t,r){return this._promiseSend("message","translate",t,r)}},{key:"recommendAsync",value:function e(t,r){return this._promiseSend("message","recommend",t,r)}},{key:"insightsAsync",value:function e(t,r){return this._promiseSend("message","insights",t,r)}},{key:"cancelRequest",value:function e(t){if(this._pending.has(t)){var r=this._pending.get(t);return r.timer&&clearTimeout(r.timer),r._handled=!0,this._pending.delete(t),setTimeout(function(){r.reject({category:H.WEBSOCKET,code:"REQUEST_CANCELLED",message:"Request was cancelled",details:{correlationId:t},correlationId:t})},0),!0}return!1}},{key:"cancelPendingRequests",value:function e(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this._pending)return 0;var r=this._pending.size,n,o=st(Xe(this._pending.entries())),i;try{var s=function e(){var r=rt(i.value,2),n=r[0],o=r[1];o.timer&&clearTimeout(o.timer),o._handled=!0,t?o.reject({category:H.WEBSOCKET,code:"REQUEST_CANCELLED",message:"Request was cancelled during cleanup",details:{correlationId:n},correlationId:n}):queueMicrotask(function(){o.reject({category:H.WEBSOCKET,code:"REQUEST_CANCELLED",message:"Request was cancelled",details:{correlationId:n},correlationId:n})})};for(o.s();!(i=o.n()).done;)s()}catch(e){o.e(e)}finally{o.f()}return this._pending.clear(),r}},{key:"cleanup",value:function e(){
// CRITICAL: Clear EventEmitter state BEFORE calling removeAllListeners
if(this.closeConnection(),this.cancelPendingRequests(!0),this._deprecatedKeys&&this._deprecatedKeys.clear(),void 0!==this._warnedQueryToken&&delete this._warnedQueryToken,this._events)for(var t in this._events)delete this._events[t];this.removeAllListeners(),
// CRITICAL: Set EventEmitter properties to null AFTER removeAllListeners
this._events=null,this._eventsCount=null,this._maxListeners=null;
// CRITICAL: Clean up JSDOM contexts created by SDK loader
var r="browser-umd";if(1,1,this.constructor._preservedJSDOM&&this.constructor._preservedJSDOM.dom)try{var n=this.constructor._preservedJSDOM.dom.window;n&&"function"==typeof n.close&&n.close(),delete this.constructor._preservedJSDOM}catch(e){}this._validatePayload=null,this._validateMessageEnvelope=null,this._emitError=null,this._ensureWebSocketImpl=null,this._handleInbound=null,this._promiseSend=null,this._registerPending=null,this._warnOnce=null,this.options=null,this.WebSocketImpl=null,this.wss=null,this.sessionId=null,this._pending=null,this._deprecatedKeys=null,this._silenceDeprecations=null,this._events=null,this._eventsCount=null,this._maxListeners=null}},{key:"removeAllListeners",value:function e(t){try{I.prototype.removeAllListeners.call(this,t)}catch(e){t?this._events&&this._events[t]&&(delete this._events[t],this._eventsCount=Math.max(0,this._eventsCount-1)):(this._events=Object.create(null),this._eventsCount=0)}return this}}],[{key:"cleanup",value:function e(){Pt=!1,qt=!1}},{key:"getSdkVersion",value:function e(){return At}},{key:"getSpecVersion",value:function e(){return G}},{key:"getSchemaRef",value:function e(){return z}},{key:"CONSTANTS",get:function e(){return re}},{key:"LegacyEvents",get:function e(){return Y}},{key:"InboundEvents",get:function e(){return Q}},{key:"buildFlags",get:function e(){var t="browser-umd";return{SALESFORCE_BUILD:!1,INCLUDE_WS_REQUIRE:!1,SDK_VERSION:"3.2.1",WEBPACK_BUILD_TARGET:t,WEBPACK_BUILD_TARGET_NORMALIZED:_e.normalize(t),BUILD_TARGET_INFO:_e.getInfo(t)}}}])}(I);kt(OptaveJavaScriptSDK,"defaultPayload",{session:{sessionId:"",channel:{browser:"",deviceInfo:"",deviceType:"",language:"",location:"",medium:"chat",metadata:[],section:""},interface:{appVersion:"",category:"",language:"",name:"",type:""}},request:{requestId:"",attributes:{content:"",instruction:"",variant:"A"},connections:{journeyId:"",parentId:"",threadId:""},context:{caseId:"",departmentId:"",operatorId:"",organizationId:"",userId:""},reference:{ids:[{name:"",value:""}],labels:[],tags:[]},resources:{codes:[{id:"",label:"",type:"",value:""}],links:[{expires_at:"",html:!1,id:"",label:"",type:"",url:""}],offers:[]},scope:{accounts:[],appointments:[],assets:[],bookings:[],cases:[],conversations:[],documents:[],events:[],interactions:[],items:[],locations:[],operators:[],orders:[],organizations:[],persons:[],policies:[],products:[{id:""}],properties:[],services:[],subscriptions:[],tickets:[],transactions:[],users:[]},settings:{disableBrowsing:!1,disableSearch:!1,disableSources:!1,disableStream:!0,disableTools:!1,maxResponseLength:0,overrideInterfaceLanguage:"",overrideOutputLanguage:""},a2a:[{id:"",name:"",type:""}],cursor:{since:"",until:""}}});const Ct=null;function Nt(e){return Nt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Nt(e)}function Ut(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Mt(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Wt(n.key),n)}}function Dt(e,t,r){return t&&Mt(e.prototype,t),r&&Mt(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function Wt(e){var t=Lt(e,"string");return"symbol"==Nt(t)?t:t+""}function Lt(e,t){if("object"!=Nt(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=Nt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}var Vt;Vt="undefined"!=typeof globalThis&&globalThis.crypto&&globalThis.crypto.getRandomValues?globalThis.crypto:"undefined"!=typeof window&&window.crypto&&window.crypto.getRandomValues?window.crypto:"undefined"!=typeof self&&self.crypto&&self.crypto.getRandomValues?self.crypto:{getRandomValues:function e(t){for(var r=0;r<t.length;r++)t[r]=Math.floor(256*Math.random());return t}};var Bt=function(){function e(){Ut(this,e),this.timestamp=0,this.counter=0,this.random=this._getRandomNumberGenerator()}return Dt(e,[{key:"_getRandomNumberGenerator",value:function e(){return void 0!==Vt&&void 0!==Vt.getRandomValues?new Kt:{nextUint32:function e(){return 65536*Math.trunc(65536*Math.random())+Math.trunc(65536*Math.random())}}}},{key:"generate",value:function e(){return this.generateOrResetCore(Date.now(),1e4)}},{key:"generateOrResetCore",value:function e(t,r){var n=this.generateOrAbortCore(t,r);return void 0===n&&(this.timestamp=0,n=this.generateOrAbortCore(t,r)),n}},{key:"generateOrAbortCore",value:function e(t,r){var n=4398046511103;if(!Number.isInteger(t)||t<1||t>0xffffffffffff)throw new RangeError("unixTsMs must be a 48-bit positive integer");if(t>this.timestamp)this.timestamp=t,this.resetCounter();else{if(!(t+r>=this.timestamp))return;this.counter++,this.counter>n&&(this.timestamp++,this.resetCounter())}return this.fromFieldsV7(this.timestamp,Math.trunc(this.counter/Math.pow(2,30)),this.counter&Math.pow(2,30)-1,this.random.nextUint32())}},{key:"resetCounter",value:function e(){this.counter=1024*this.random.nextUint32()+(1023&this.random.nextUint32())}},{key:"fromFieldsV7",value:function e(t,r,n,o){var i=new Uint8Array(16);return i[0]=t/Math.pow(2,40),i[1]=t/Math.pow(2,32),i[2]=t/Math.pow(2,24),i[3]=t/Math.pow(2,16),i[4]=t/Math.pow(2,8),i[5]=t,i[6]=112|r>>>8,i[7]=r,i[8]=128|n>>>24,i[9]=n>>>16,i[10]=n>>>8,i[11]=n,i[12]=o>>>24,i[13]=o>>>16,i[14]=o>>>8,i[15]=o,this.bytesToString(i)}},{key:"bytesToString",value:function e(t){var r=Array.from(t,function(e){return e.toString(16).padStart(2,"0")}).join("");return[r.substring(0,8),r.substring(8,12),r.substring(12,16),r.substring(16,20),r.substring(20,32)].join("-")}}])}(),Kt=function(){function e(){Ut(this,e),this.buffer=new Uint32Array(8),this.cursor=65535}return Dt(e,[{key:"nextUint32",value:function e(){return this.cursor>=this.buffer.length&&(Vt.getRandomValues(this.buffer),this.cursor=0),this.buffer[this.cursor++]}}])}(),xt=null;function Gt(e,t){if(e&&!e.crypto)try{var r=Object.getOwnPropertyDescriptor(e,t);r&&!1===r.configurable||(e.crypto=Vt)}catch(t){console.debug("Cannot set crypto property on",e.constructor.name,":",t.message)}}Vt.randomUUID=function(){return xt||(xt=new Bt),xt.generate()},Vt.generateUUID=function(){return xt||(xt=new Bt),xt.generate()},Vt.generateShortId=function(){return Math.random().toString(36).substr(2,9)},"undefined"!=typeof globalThis&&Gt(globalThis,"crypto"),"undefined"!=typeof window&&Gt(window,"crypto"),"undefined"!=typeof self&&Gt(self,"crypto");try{"undefined"!=typeof module&&"object"===Nt(module.exports)&&"undefined"!=typeof require&&(module.exports=Vt,module.exports.default=Vt,module.exports.getRandomValues=Vt.getRandomValues.bind(Vt),module.exports.randomUUID=Vt.randomUUID?Vt.randomUUID.bind(Vt):Vt.randomUUID,module.exports.generateUUID=Vt.generateUUID.bind(Vt),module.exports.generateShortId=Vt.generateShortId.bind(Vt))}catch(e){}var Ft=Vt.getRandomValues.bind(Vt),zt=Vt.randomUUID?Vt.randomUUID.bind(Vt):Vt.randomUUID,Ht=Vt.generateUUID.bind(Vt),Yt=Vt.generateShortId.bind(Vt);const Jt=null;if("undefined"!=typeof globalThis&&!globalThis.OptaveJavaScriptSDK)try{globalThis.OptaveJavaScriptSDK=OptaveJavaScriptSDK}catch(e){}const Qt=OptaveJavaScriptSDK;return n=n.default})());
//# sourceMappingURL=browser.umd.js.map